<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>storefrontapp documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">storefrontapp documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li >ProfileTagPushEventsService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>A service to convert spartacus events into profiletag push events that can be picked up and processed by profiletag.
The service observes the event service and the active cart service for supported events. These events are parsed into
a profiletag compliant format and enriched by segments and actions from the latest personalization context.</p>
<p>Currently supported events from the event service:</p>
<ul>
<li>CartPageVisited</li>
<li>CategoryPageVisited</li>
<li>HomePageVisited</li>
<li>KeywordSearchPageVisited</li>
<li>OrderConfirmationPageVisited</li>
<li>PageVisited</li>
<li>ProductDetailsPageVisited</li>
<li>CartAddEntrySuccessEvent</li>
<li>CartRemoveEntrySuccessEvent</li>
<li>CartUpdateEntrySuccessEvent</li>
</ul>

            </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#pushEvents$" >pushEvents$</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#addedToCart" >addedToCart</a>
                            </li>
                            <li>
                                <a href="#addPushEvent" >addPushEvent</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#cartPageVisitedEvent" >cartPageVisitedEvent</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#categoriesToIds" >categoriesToIds</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#categoryPageVisited" >categoryPageVisited</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getProductPrice" >getProductPrice</a>
                            </li>
                            <li>
                                <a href="#getPushEvents" >getPushEvents</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#homePageVisitedEvent" >homePageVisitedEvent</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#modifiedCart" >modifiedCart</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#navigatedEvent" >navigatedEvent</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#orderConfirmationPageVisited" >orderConfirmationPageVisited</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#productDetailsPageView" >productDetailsPageView</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#removedFromCart" >removedFromCart</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#searchResultsChanged" >searchResultsChanged</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(eventService: <a href="../injectables/EventService.html" target="_self">EventService</a>, personalizationContextService: <a href="../injectables/PersonalizationContextService.html" target="_self">PersonalizationContextService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="75" class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:75</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>eventService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/EventService.html" target="_self" >EventService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>personalizationContextService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PersonalizationContextService.html" target="_self" >PersonalizationContextService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addedToCart"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>addedToCart</b></span>
                        <a href="#addedToCart"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>addedToCart()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="262"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:262</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to CartAddEntrySuccessEvent events, transforms them to AddedToCartPushEvent.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting AddedToCartPushEvent events</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addPushEvent"></a>
                    <span class="name">
                        <span ><b>addPushEvent</b></span>
                        <a href="#addPushEvent"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>addPushEvent(event: <a href="../interfaces/ProfileTagPushEvent.html" target="_self">Observable&lt;ProfileTagPushEvent&gt;</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="111"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:111</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Adds a new push event emitting observable to this service. This observable will be merged with the internal one.
This method can be used to extend the functionality of this service at runtime.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>event</td>
                                    <td>
                                                <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>an observable emitting profiltag push events</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="cartPageVisitedEvent"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>cartPageVisitedEvent</b></span>
                        <a href="#cartPageVisitedEvent"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>cartPageVisitedEvent()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="223"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:223</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to CartPageVisited events</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe cart page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="categoriesToIds"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>categoriesToIds</b></span>
                        <a href="#categoriesToIds"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>categoriesToIds(categories: Array<Category>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="366"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:366</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>categories</td>
                                    <td>
                                            <code>Array&lt;Category&gt;</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Array&lt;string&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="categoryPageVisited"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>categoryPageVisited</b></span>
                        <a href="#categoryPageVisited"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>categoryPageVisited()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="123"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:123</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Emits the category page visited event.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe category page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getProductPrice"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>getProductPrice</b></span>
                        <a href="#getProductPrice"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getProductPrice(event: <a href="../classes/CartAddEntrySuccessEvent.html" target="_self">CartAddEntrySuccessEvent</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="354"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:354</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>event</td>
                                    <td>
                                                <code><a href="../classes/CartAddEntrySuccessEvent.html" target="_self" >CartAddEntrySuccessEvent</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number" target="_blank" >Number</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPushEvents"></a>
                    <span class="name">
                        <span ><b>getPushEvents</b></span>
                        <a href="#getPushEvents"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getPushEvents()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="88"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:88</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Returns a push event emitting observable that emits all converted events emitted by the event or the active cart service.
These events are enriched with segments and actions from the latest personalization context.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting profiletag push events</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="homePageVisitedEvent"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>homePageVisitedEvent</b></span>
                        <a href="#homePageVisitedEvent"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>homePageVisitedEvent()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="236"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:236</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to HomePageEvent events</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe home page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="modifiedCart"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>modifiedCart</b></span>
                        <a href="#modifiedCart"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>modifiedCart()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="328"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:328</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to @CartUpdateEntrySuccessEvent events, transforms them to @ModifiedCartPushEvent</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting </p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="navigatedEvent"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>navigatedEvent</b></span>
                        <a href="#navigatedEvent"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>navigatedEvent()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="210"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:210</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to PageVisited events</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="orderConfirmationPageVisited"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>orderConfirmationPageVisited</b></span>
                        <a href="#orderConfirmationPageVisited"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>orderConfirmationPageVisited()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="249"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:249</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to OrderPlacedEvent events</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe order confirmation page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="productDetailsPageView"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>productDetailsPageView</b></span>
                        <a href="#productDetailsPageView"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>productDetailsPageView()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="183"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:183</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to ProductDetailsPageEvent events</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe product detail page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="removedFromCart"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>removedFromCart</b></span>
                        <a href="#removedFromCart"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>removedFromCart()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="296"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:296</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to @CartRemoveEntrySuccessEvent events, transforms them to @RemovedFromCartPushEvent</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting </p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="searchResultsChanged"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>searchResultsChanged</b></span>
                        <a href="#searchResultsChanged"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>searchResultsChanged()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="163"
                            class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:163</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Listens to SearchPageResultsEvent events</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>an observable emitting events that describe keyword search page visits in a profiltag compliant way</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="pushEvents$"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>pushEvents$</b></span>
                        <a href="#pushEvents$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../interfaces/ProfileTagPushEvent.html" target="_self" >Observable&lt;ProfileTagPushEvent&gt;</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>merge(
    this.categoryPageVisited(),
    this.productDetailsPageView(),
    this.searchResultsChanged(),
    this.homePageVisitedEvent(),
    this.cartPageVisitedEvent(),
    this.navigatedEvent(),
    this.orderConfirmationPageVisited(),
    this.addedToCart(),
    this.removedFromCart(),
    this.modifiedCart()
  )</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="64" class="link-to-prism">integration-libs/cds/src/profiletag/services/profile-tag-push-events.service.ts:64</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { OrderPlacedEvent } from &#x27;@spartacus/checkout/root&#x27;;
import {
  CartAddEntrySuccessEvent,
  CartRemoveEntrySuccessEvent,
  CartUpdateEntrySuccessEvent,
  Category,
  EventService,
} from &#x27;@spartacus/core&#x27;;
import {
  CartPageEvent,
  CategoryPageResultsEvent,
  HomePageEvent,
  PageEvent,
  ProductDetailsPageEvent,
  SearchPageResultsEvent,
} from &#x27;@spartacus/storefront&#x27;;
import { PersonalizationContextService } from &#x27;@spartacus/tracking/personalization/core&#x27;;
import { merge, Observable, of } from &#x27;rxjs&#x27;;
import {
  distinctUntilChanged,
  distinctUntilKeyChanged,
  map,
  mapTo,
  pairwise,
  startWith,
  withLatestFrom,
} from &#x27;rxjs/operators&#x27;;
import {
  AddedToCartPushEvent,
  CartViewPushEvent,
  CategoryViewPushEvent,
  HomePageViewPushEvent,
  KeywordSearchPushEvent,
  ModifiedCartPushEvent,
  NavigatedPushEvent,
  OrderConfirmationPushEvent,
  ProductViewPushEvent,
  ProfileTagPushEvent,
  RemovedFromCartPushEvent,
} from &#x27;../model/profile-tag.model&#x27;;

/**
 * A service to convert spartacus events into profiletag push events that can be picked up and processed by profiletag.
 * The service observes the event service and the active cart service for supported events. These events are parsed into
 * a profiletag compliant format and enriched by segments and actions from the latest personalization context.
 *
 * Currently supported events from the event service:
 *  - CartPageVisited
 *  - CategoryPageVisited
 *  - HomePageVisited
 *  - KeywordSearchPageVisited
 *  - OrderConfirmationPageVisited
 *  - PageVisited
 *  - ProductDetailsPageVisited
 *  - CartAddEntrySuccessEvent
 *  - CartRemoveEntrySuccessEvent
 *  - CartUpdateEntrySuccessEvent
 */
@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class ProfileTagPushEventsService {
  private pushEvents$: Observable&lt;ProfileTagPushEvent&gt; &#x3D; merge(
    this.categoryPageVisited(),
    this.productDetailsPageView(),
    this.searchResultsChanged(),
    this.homePageVisitedEvent(),
    this.cartPageVisitedEvent(),
    this.navigatedEvent(),
    this.orderConfirmationPageVisited(),
    this.addedToCart(),
    this.removedFromCart(),
    this.modifiedCart()
  );

  constructor(
    protected eventService: EventService,
    protected personalizationContextService: PersonalizationContextService
  ) {}

  /**
   * Returns a push event emitting observable that emits all converted events emitted by the event or the active cart service.
   * These events are enriched with segments and actions from the latest personalization context.
   *
   * @returns an observable emitting profiletag push events
   */
  getPushEvents(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.pushEvents$.pipe(
      withLatestFrom(
        merge(
          of({ segments: undefined, actions: undefined }),
          this.personalizationContextService.getPersonalizationContext()
        )
      ),
      map(([item, personalizationContext]) &#x3D;&gt; {
        item.data &#x3D; item.data ? item.data : {};
        item.data.segments &#x3D; personalizationContext?.segments;
        item.data.actions &#x3D; personalizationContext?.actions;
        return item;
      })
    );
  }

  /**
   * Adds a new push event emitting observable to this service. This observable will be merged with the internal one.
   * This method can be used to extend the functionality of this service at runtime.
   *
   * @param event an observable emitting profiltag push events
   */
  addPushEvent(event: Observable&lt;ProfileTagPushEvent&gt;): void {
    this.pushEvents$ &#x3D; merge(this.pushEvents$, event);
  }

  /**
   * Emits the category page visited event.
   *
   * @returns an observable emitting events that describe category page visits in a profiltag compliant way
   * @see CategoryPageResultsEvent
   * @see CategoryViewPushEvent
   */

  protected categoryPageVisited(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService.get(CategoryPageResultsEvent).pipe(
      withLatestFrom(
        this.eventService.get(PageEvent).pipe(
          startWith(&lt;PageEvent&gt;null), // https://github.com/ReactiveX/rxjs/issues/4772
          pairwise()
        )
      ),
      distinctUntilChanged(
        (
          [previouslyEmittedCategoryPage],
          [currentCategoryPage, [previousRoute, currentRoute]]
        ) &#x3D;&gt; {
          return (
            previouslyEmittedCategoryPage.categoryCode &#x3D;&#x3D;&#x3D;
              currentCategoryPage.categoryCode &amp;&amp;
            previousRoute.navigation.semanticRoute &#x3D;&#x3D;&#x3D;
              currentRoute.navigation.semanticRoute
          ); // A true means that this item is not unique, so this is hard to wrap your head around.
          // What we are saying, is that if the categoryCode is the same AND the last emitted semantic route is the same
          // then this is a duplicate (I.E. via a facet change). In other words, no other page type was visited, and we are on the same categorycode
        }
      ),
      map(
        ([categoryPageEvent]) &#x3D;&gt;
          new CategoryViewPushEvent({
            productCategory: categoryPageEvent.categoryCode,
            productCategoryName: categoryPageEvent.categoryName,
          })
      )
    );
  }

  /**
   * Listens to SearchPageResultsEvent events
   *
   * @returns an observable emitting events that describe keyword search page visits in a profiltag compliant way
   * @see SearchPageResultsEvent
   * @see KeywordSearchPushEvent
   */
  protected searchResultsChanged(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService.get(SearchPageResultsEvent).pipe(
      distinctUntilKeyChanged(&#x27;searchTerm&#x27;),
      map(
        (searchEvent) &#x3D;&gt;
          new KeywordSearchPushEvent({
            searchTerm: searchEvent.searchTerm,
            numResults: searchEvent.numberOfResults,
          })
      )
    );
  }

  /**
   * Listens to ProductDetailsPageEvent events
   *
   * @returns an observable emitting events that describe product detail page visits in a profiltag compliant way
   * @see ProductDetailsPageEvent
   * @see ProductViewPushEvent
   */
  protected productDetailsPageView(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService.get(ProductDetailsPageEvent).pipe(
      map(
        (item) &#x3D;&gt;
          new ProductViewPushEvent({
            productSku: item.code,
            productName: item.name,
            productPrice: item.price ? item.price.value : undefined,
            productCategoryName: item.categories
              ? item.categories[item.categories.length - 1].name
              : undefined,
            productCategory: item.categories
              ? item.categories[item.categories.length - 1].code
              : undefined,
            categories: this.categoriesToIds(item.categories),
          })
      )
    );
  }

  /**
   * Listens to PageVisited events
   *
   * @returns an observable emitting events that describe page visits in a profiltag compliant way
   * @see PageVisited
   * @see NavigatedPushEvent
   */
  protected navigatedEvent(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService
      .get(PageEvent)
      .pipe(mapTo(new NavigatedPushEvent()));
  }

  /**
   * Listens to CartPageVisited events
   *
   * @returns an observable emitting events that describe cart page visits in a profiltag compliant way
   * @see CartPageVisited
   * @see CartViewPushEvent
   */
  protected cartPageVisitedEvent(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService
      .get(CartPageEvent)
      .pipe(mapTo(new CartViewPushEvent()));
  }

  /**
   * Listens to HomePageEvent events
   *
   * @returns an observable emitting events that describe home page visits in a profiltag compliant way
   * @see HomePageEvent
   * @see HomePageViewPushEvent
   */
  protected homePageVisitedEvent(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService
      .get(HomePageEvent)
      .pipe(mapTo(new HomePageViewPushEvent()));
  }

  /**
   * Listens to OrderPlacedEvent events
   *
   * @returns an observable emitting events that describe order confirmation page visits in a profiltag compliant way
   * @see OrderPlacedEvent
   * @see OrderConfirmationPushEvent
   */
  protected orderConfirmationPageVisited(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService
      .get(OrderPlacedEvent)
      .pipe(mapTo(new OrderConfirmationPushEvent()));
  }

  /**
   * Listens to CartAddEntrySuccessEvent events, transforms them to AddedToCartPushEvent.
   *
   * @returns an observable emitting AddedToCartPushEvent events
   * @see CartAddEntrySuccessEvent
   * @see AddedToCartPushEvent
   */
  protected addedToCart(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService.get(CartAddEntrySuccessEvent).pipe(
      map(
        (item) &#x3D;&gt;
          new AddedToCartPushEvent({
            productQty: item.quantityAdded,
            productSku: item.entry.product.code,
            productName: item.entry.product.name,
            cartId: item.cartId,
            cartCode: item.cartCode,
            productPrice: this.getProductPrice(item),
            categories: this.categoriesToIds(item.entry.product.categories),
            productCategoryName: item.entry.product.categories
              ? item.entry.product.categories[
                  item.entry.product.categories.length - 1
                ].name
              : undefined,
            productCategory: item.entry.product.categories
              ? item.entry.product.categories[
                  item.entry.product.categories.length - 1
                ].code
              : undefined,
          })
      )
    );
  }

  /**
   * Listens to @CartRemoveEntrySuccessEvent events, transforms them to @RemovedFromCartPushEvent
   *
   * @returns an observable emitting @RemovedFromCartPushEvent events
   * @see CartRemoveEntrySuccessEvent
   * @see RemovedFromCartPushEvent
   */
  protected removedFromCart(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService.get(CartRemoveEntrySuccessEvent).pipe(
      map(
        (item) &#x3D;&gt;
          new RemovedFromCartPushEvent({
            productSku: item.entry.product.code,
            productName: item.entry.product.name,
            cartId: item.cartId,
            cartCode: item.cartCode,
            productCategoryName: item.entry.product.categories
              ? item.entry.product.categories[
                  item.entry.product.categories.length - 1
                ].name
              : undefined,
            productCategory: item.entry.product.categories
              ? item.entry.product.categories[
                  item.entry.product.categories.length - 1
                ].code
              : undefined,
            categories: this.categoriesToIds(item.entry.product.categories),
          })
      )
    );
  }

  /**
   * Listens to @CartUpdateEntrySuccessEvent events, transforms them to @ModifiedCartPushEvent
   *
   * @returns an observable emitting @RemovedFromCartPushEvent events
   * @see CartRemoveEntrySuccessEvent
   * @see ModifiedCartPushEvent
   */
  protected modifiedCart(): Observable&lt;ProfileTagPushEvent&gt; {
    return this.eventService.get(CartUpdateEntrySuccessEvent).pipe(
      map(
        (item) &#x3D;&gt;
          new ModifiedCartPushEvent({
            productQty: item.quantity,
            productSku: item.entry.product.code,
            productName: item.entry.product.name,
            cartId: item.cartId,
            cartCode: item.cartCode,
            categories: this.categoriesToIds(item.entry.product.categories),
            productCategoryName: item.entry.product.categories
              ? item.entry.product.categories[
                  item.entry.product.categories.length - 1
                ].name
              : undefined,
            productCategory: item.entry.product.categories
              ? item.entry.product.categories[
                  item.entry.product.categories.length - 1
                ].code
              : undefined,
          })
      )
    );
  }

  private getProductPrice(event: CartAddEntrySuccessEvent): Number {
    if (
      !event.entry.totalPrice ||
      !event.entry.totalPrice.value ||
      !event.entry.quantity
    ) {
      return undefined;
    }
    return parseFloat(
      (event.entry.totalPrice.value / event.entry.quantity).toFixed(2)
    );
  }
  private categoriesToIds(categories: Array&lt;Category&gt;): Array&lt;string&gt; {
    return categories.map((category) &#x3D;&gt; category.code);
  }
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ProfileTagPushEventsService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       
       <script type="module" src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
