/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { CartOutlets, PromotionLocation, } from '@spartacus/cart/base/root';
import { deliveryAddressCard, deliveryModeCard } from '@spartacus/order/root';
import { ICON_TYPE } from '@spartacus/storefront';
import { combineLatest } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/checkout/base/root";
import * as i2 from "@spartacus/cart/base/root";
import * as i3 from "@spartacus/core";
import * as i4 from "../services/checkout-step.service";
import * as i5 from "@angular/common";
import * as i6 from "@spartacus/storefront";
import * as i7 from "@angular/router";
export class CheckoutReviewSubmitComponent {
    constructor(checkoutDeliveryAddressFacade, checkoutPaymentFacade, activeCartFacade, translationService, checkoutStepService, checkoutDeliveryModesFacade) {
        this.checkoutDeliveryAddressFacade = checkoutDeliveryAddressFacade;
        this.checkoutPaymentFacade = checkoutPaymentFacade;
        this.activeCartFacade = activeCartFacade;
        this.translationService = translationService;
        this.checkoutStepService = checkoutStepService;
        this.checkoutDeliveryModesFacade = checkoutDeliveryModesFacade;
        this.cartOutlets = CartOutlets;
        this.iconTypes = ICON_TYPE;
        this.checkoutStepTypeDeliveryAddress = "deliveryAddress" /* CheckoutStepType.DELIVERY_ADDRESS */;
        this.checkoutStepTypePaymentDetails = "paymentDetails" /* CheckoutStepType.PAYMENT_DETAILS */;
        this.checkoutStepTypeDeliveryMode = "deliveryMode" /* CheckoutStepType.DELIVERY_MODE */;
        this.promotionLocation = PromotionLocation.ActiveCart;
        this.steps$ = this.checkoutStepService.steps$;
        this.deliveryAddress$ = this.checkoutDeliveryAddressFacade.getDeliveryAddressState().pipe(filter((state) => !state.loading && !state.error), map((state) => state.data));
        this.deliveryMode$ = this.checkoutDeliveryModesFacade.getSelectedDeliveryModeState().pipe(filter((state) => !state.loading && !state.error), map((state) => state.data));
        this.paymentDetails$ = this.checkoutPaymentFacade.getPaymentDetailsState().pipe(filter((state) => !state.loading && !state.error), map((state) => state.data));
    }
    get cart$() {
        return this.activeCartFacade.getActive();
    }
    get entries$() {
        return this.activeCartFacade.getEntries();
    }
    getCheckoutDeliverySteps() {
        return ["deliveryAddress" /* CheckoutStepType.DELIVERY_ADDRESS */, "deliveryMode" /* CheckoutStepType.DELIVERY_MODE */];
    }
    getCheckoutPaymentSteps() {
        return [
            "paymentDetails" /* CheckoutStepType.PAYMENT_DETAILS */,
            "deliveryAddress" /* CheckoutStepType.DELIVERY_ADDRESS */,
        ];
    }
    getDeliveryAddressCard(deliveryAddress, countryName) {
        return combineLatest([
            this.translationService.translate('addressCard.shipTo'),
            this.translationService.translate('addressCard.phoneNumber'),
            this.translationService.translate('addressCard.mobileNumber'),
        ]).pipe(map(([textTitle, textPhone, textMobile]) => deliveryAddressCard(textTitle, textPhone, textMobile, deliveryAddress, countryName)));
    }
    getDeliveryModeCard(deliveryMode) {
        return combineLatest([
            this.translationService.translate('checkoutMode.deliveryMethod'),
        ]).pipe(map(([textTitle]) => deliveryModeCard(textTitle, deliveryMode)));
    }
    getPaymentMethodCard(paymentDetails) {
        return combineLatest([
            this.translationService.translate('paymentForm.payment'),
            this.translationService.translate('paymentCard.expires', {
                month: paymentDetails.expiryMonth,
                year: paymentDetails.expiryYear,
            }),
            this.translationService.translate('paymentForm.billingAddress'),
        ]).pipe(map(([textTitle, textExpires, billingAddress]) => {
            const region = paymentDetails.billingAddress?.region?.isocode
                ? paymentDetails.billingAddress?.region?.isocode + ', '
                : '';
            return {
                title: textTitle,
                textBold: paymentDetails.accountHolderName,
                text: [paymentDetails.cardNumber, textExpires],
                paragraphs: [
                    {
                        title: billingAddress + ':',
                        text: [
                            paymentDetails.billingAddress?.firstName +
                                ' ' +
                                paymentDetails.billingAddress?.lastName,
                            paymentDetails.billingAddress?.line1,
                            paymentDetails.billingAddress?.town +
                                ', ' +
                                region +
                                paymentDetails.billingAddress?.country?.isocode,
                            paymentDetails.billingAddress?.postalCode,
                        ],
                    },
                ],
            };
        }));
    }
    getCheckoutStepUrl(stepType) {
        const step = this.checkoutStepService.getCheckoutStep(stepType);
        return step?.routeName;
    }
    deliverySteps(steps) {
        return steps.filter((step) => this.getCheckoutDeliverySteps().includes(step.type[0]));
    }
    paymentSteps(steps) {
        return steps.filter((step) => this.getCheckoutPaymentSteps().includes(step.type[0]));
    }
}
CheckoutReviewSubmitComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CheckoutReviewSubmitComponent, deps: [{ token: i1.CheckoutDeliveryAddressFacade }, { token: i1.CheckoutPaymentFacade }, { token: i2.ActiveCartFacade }, { token: i3.TranslationService }, { token: i4.CheckoutStepService }, { token: i1.CheckoutDeliveryModesFacade }], target: i0.ɵɵFactoryTarget.Component });
CheckoutReviewSubmitComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: CheckoutReviewSubmitComponent, selector: "cx-review-submit", ngImport: i0, template: "<div class=\"cx-review\">\n  <!-- TITLE -->\n  <h2 class=\"cx-review-title d-none d-lg-block d-xl-block\">\n    {{ 'checkoutReview.review' | cxTranslate }}\n  </h2>\n\n  <div class=\"cx-review-summary row\">\n    <ng-container *ngIf=\"(steps$ | async)?.slice(0, -1) as steps\">\n      <div class=\"col-md-12 col-lg-6 col-xl-6 cx-review-payment-col\">\n        <ng-container *ngFor=\"let step of paymentSteps(steps)\">\n          <ng-container [ngSwitch]=\"step.type[0]\">\n            <ng-container *ngSwitchCase=\"checkoutStepTypePaymentDetails\">\n              <ng-container *ngTemplateOutlet=\"paymentMethod\"></ng-container>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n      </div>\n      <div class=\"col-md-12 col-lg-6 col-xl-6 cx-review-shipping-col\">\n        <ng-container *ngFor=\"let step of deliverySteps(steps)\">\n          <ng-container [ngSwitch]=\"step.type[0]\">\n            <ng-container *ngSwitchCase=\"checkoutStepTypeDeliveryAddress\">\n              <ng-container *ngTemplateOutlet=\"deliveryAddress\"></ng-container>\n            </ng-container>\n            <ng-container *ngSwitchCase=\"checkoutStepTypeDeliveryMode\">\n              <ng-container *ngTemplateOutlet=\"deliveryMode\"></ng-container>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n      </div>\n    </ng-container>\n  </div>\n\n  <!-- DELIVERY ADDRESS SECTION -->\n  <ng-template #deliveryAddress>\n    <div\n      *ngIf=\"deliveryAddress$ | async as deliveryAddress\"\n      class=\"cx-review-summary-card cx-review-card-address\"\n    >\n      <cx-card\n        [content]=\"getDeliveryAddressCard(deliveryAddress) | async\"\n      ></cx-card>\n      <div class=\"cx-review-summary-edit-step\">\n        <a\n          [attr.aria-label]=\"\n            'checkoutReview.editDeliveryAddressDetails' | cxTranslate\n          \"\n          [routerLink]=\"\n            {\n              cxRoute: getCheckoutStepUrl(checkoutStepTypeDeliveryAddress)\n            } | cxUrl\n          \"\n          ><cx-icon aria-hidden=\"true\" [type]=\"iconTypes.PENCIL\"></cx-icon\n        ></a>\n      </div>\n    </div>\n  </ng-template>\n\n  <!-- DELIVERY MODE SECTION -->\n  <ng-template #deliveryMode>\n    <div class=\"cx-review-summary-card cx-review-card-shipping\">\n      <!-- TODO:(CXINT-2309) for next major release remove feature level -->\n      <ng-container *cxFeatureLevel=\"'!6.4'\">\n        <cx-card\n          *ngIf=\"deliveryMode$ | async as deliveryMode\"\n          [content]=\"getDeliveryModeCard(deliveryMode) | async\"\n        >\n        </cx-card>\n      </ng-container>\n      <!-- TODO:(CXINT-2309) for next major release remove feature level -->\n      <ng-container *cxFeatureLevel=\"'6.4'\">\n        <div>\n          <cx-card\n            *ngIf=\"deliveryMode$ | async as deliveryMode\"\n            [content]=\"getDeliveryModeCard(deliveryMode) | async\"\n          >\n          </cx-card>\n          <ng-template\n            [cxOutlet]=\"cartOutlets.DELIVERY_MODE\"\n            [cxOutletContext]=\"{\n              item: cart$ | async,\n              readonly: true\n            }\"\n          >\n          </ng-template>\n        </div>\n      </ng-container>\n\n      <div class=\"cx-review-summary-edit-step\">\n        <a\n          [attr.aria-label]=\"'checkoutReview.editDeliveryMode' | cxTranslate\"\n          [routerLink]=\"\n            { cxRoute: getCheckoutStepUrl(checkoutStepTypeDeliveryMode) }\n              | cxUrl\n          \"\n        >\n          <cx-icon aria-hidden=\"true\" [type]=\"iconTypes.PENCIL\"></cx-icon>\n        </a>\n      </div>\n    </div>\n  </ng-template>\n\n  <!-- PAYMENT METHOD SECTION -->\n  <ng-template #paymentMethod>\n    <div class=\"cx-review-summary-card cx-review-card-payment\">\n      <div>\n        <cx-card\n          *ngIf=\"paymentDetails$ | async as paymentDetails\"\n          [content]=\"getPaymentMethodCard(paymentDetails) | async\"\n        ></cx-card>\n      </div>\n      <div class=\"cx-review-summary-edit-step\">\n        <a\n          [attr.aria-label]=\"'checkoutReview.editPaymentDetails' | cxTranslate\"\n          [routerLink]=\"\n            { cxRoute: getCheckoutStepUrl(checkoutStepTypePaymentDetails) }\n              | cxUrl\n          \"\n        >\n          <cx-icon aria-hidden=\"true\" [type]=\"iconTypes.PENCIL\"></cx-icon>\n        </a>\n      </div>\n    </div>\n  </ng-template>\n\n  <!-- CART ITEM SECTION -->\n  <ng-container *ngIf=\"cart$ | async as cart\">\n    <div class=\"cx-review-cart-total d-none d-lg-block d-xl-block\">\n      {{\n        'cartItems.cartTotal'\n          | cxTranslate: { count: cart.deliveryItemsQuantity }\n      }}:\n      {{ cart.totalPrice?.formattedValue }}\n    </div>\n    <div class=\"cx-review-cart-heading d-block d-lg-none d-xl-none\">\n      {{ 'checkoutReview.placeOrder' | cxTranslate }}\n    </div>\n    <div class=\"cx-review-cart-item\" *ngIf=\"entries$ | async as entries\">\n      <cx-promotions\n        [promotions]=\"\n          (cart.appliedOrderPromotions || []).concat(\n            cart.potentialOrderPromotions || []\n          )\n        \"\n      ></cx-promotions>\n\n      <ng-template\n        [cxOutlet]=\"cartOutlets.CART_ITEM_LIST\"\n        [cxOutletContext]=\"{\n          items: entries,\n          readonly: true,\n          promotionLocation: promotionLocation\n        }\"\n      >\n      </ng-template>\n    </div>\n  </ng-container>\n</div>\n", dependencies: [{ kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i5.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i5.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { kind: "directive", type: i5.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { kind: "component", type: i6.CardComponent, selector: "cx-card", inputs: ["border", "editMode", "isDefault", "content", "fitToContainer", "truncateText", "charactersLimit", "index"], outputs: ["deleteCard", "setDefaultCard", "sendCard", "editCard", "cancelCard"] }, { kind: "directive", type: i7.RouterLink, selector: "[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "component", type: i6.PromotionsComponent, selector: "cx-promotions", inputs: ["promotions"] }, { kind: "component", type: i6.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "directive", type: i6.OutletDirective, selector: "[cxOutlet]", inputs: ["cxOutlet", "cxOutletContext", "cxOutletDefer", "cxComponentRef"], outputs: ["loaded", "cxComponentRefChange"] }, { kind: "directive", type: i3.FeatureLevelDirective, selector: "[cxFeatureLevel]", inputs: ["cxFeatureLevel"] }, { kind: "pipe", type: i5.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.TranslatePipe, name: "cxTranslate" }, { kind: "pipe", type: i3.UrlPipe, name: "cxUrl" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CheckoutReviewSubmitComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-review-submit', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"cx-review\">\n  <!-- TITLE -->\n  <h2 class=\"cx-review-title d-none d-lg-block d-xl-block\">\n    {{ 'checkoutReview.review' | cxTranslate }}\n  </h2>\n\n  <div class=\"cx-review-summary row\">\n    <ng-container *ngIf=\"(steps$ | async)?.slice(0, -1) as steps\">\n      <div class=\"col-md-12 col-lg-6 col-xl-6 cx-review-payment-col\">\n        <ng-container *ngFor=\"let step of paymentSteps(steps)\">\n          <ng-container [ngSwitch]=\"step.type[0]\">\n            <ng-container *ngSwitchCase=\"checkoutStepTypePaymentDetails\">\n              <ng-container *ngTemplateOutlet=\"paymentMethod\"></ng-container>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n      </div>\n      <div class=\"col-md-12 col-lg-6 col-xl-6 cx-review-shipping-col\">\n        <ng-container *ngFor=\"let step of deliverySteps(steps)\">\n          <ng-container [ngSwitch]=\"step.type[0]\">\n            <ng-container *ngSwitchCase=\"checkoutStepTypeDeliveryAddress\">\n              <ng-container *ngTemplateOutlet=\"deliveryAddress\"></ng-container>\n            </ng-container>\n            <ng-container *ngSwitchCase=\"checkoutStepTypeDeliveryMode\">\n              <ng-container *ngTemplateOutlet=\"deliveryMode\"></ng-container>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n      </div>\n    </ng-container>\n  </div>\n\n  <!-- DELIVERY ADDRESS SECTION -->\n  <ng-template #deliveryAddress>\n    <div\n      *ngIf=\"deliveryAddress$ | async as deliveryAddress\"\n      class=\"cx-review-summary-card cx-review-card-address\"\n    >\n      <cx-card\n        [content]=\"getDeliveryAddressCard(deliveryAddress) | async\"\n      ></cx-card>\n      <div class=\"cx-review-summary-edit-step\">\n        <a\n          [attr.aria-label]=\"\n            'checkoutReview.editDeliveryAddressDetails' | cxTranslate\n          \"\n          [routerLink]=\"\n            {\n              cxRoute: getCheckoutStepUrl(checkoutStepTypeDeliveryAddress)\n            } | cxUrl\n          \"\n          ><cx-icon aria-hidden=\"true\" [type]=\"iconTypes.PENCIL\"></cx-icon\n        ></a>\n      </div>\n    </div>\n  </ng-template>\n\n  <!-- DELIVERY MODE SECTION -->\n  <ng-template #deliveryMode>\n    <div class=\"cx-review-summary-card cx-review-card-shipping\">\n      <!-- TODO:(CXINT-2309) for next major release remove feature level -->\n      <ng-container *cxFeatureLevel=\"'!6.4'\">\n        <cx-card\n          *ngIf=\"deliveryMode$ | async as deliveryMode\"\n          [content]=\"getDeliveryModeCard(deliveryMode) | async\"\n        >\n        </cx-card>\n      </ng-container>\n      <!-- TODO:(CXINT-2309) for next major release remove feature level -->\n      <ng-container *cxFeatureLevel=\"'6.4'\">\n        <div>\n          <cx-card\n            *ngIf=\"deliveryMode$ | async as deliveryMode\"\n            [content]=\"getDeliveryModeCard(deliveryMode) | async\"\n          >\n          </cx-card>\n          <ng-template\n            [cxOutlet]=\"cartOutlets.DELIVERY_MODE\"\n            [cxOutletContext]=\"{\n              item: cart$ | async,\n              readonly: true\n            }\"\n          >\n          </ng-template>\n        </div>\n      </ng-container>\n\n      <div class=\"cx-review-summary-edit-step\">\n        <a\n          [attr.aria-label]=\"'checkoutReview.editDeliveryMode' | cxTranslate\"\n          [routerLink]=\"\n            { cxRoute: getCheckoutStepUrl(checkoutStepTypeDeliveryMode) }\n              | cxUrl\n          \"\n        >\n          <cx-icon aria-hidden=\"true\" [type]=\"iconTypes.PENCIL\"></cx-icon>\n        </a>\n      </div>\n    </div>\n  </ng-template>\n\n  <!-- PAYMENT METHOD SECTION -->\n  <ng-template #paymentMethod>\n    <div class=\"cx-review-summary-card cx-review-card-payment\">\n      <div>\n        <cx-card\n          *ngIf=\"paymentDetails$ | async as paymentDetails\"\n          [content]=\"getPaymentMethodCard(paymentDetails) | async\"\n        ></cx-card>\n      </div>\n      <div class=\"cx-review-summary-edit-step\">\n        <a\n          [attr.aria-label]=\"'checkoutReview.editPaymentDetails' | cxTranslate\"\n          [routerLink]=\"\n            { cxRoute: getCheckoutStepUrl(checkoutStepTypePaymentDetails) }\n              | cxUrl\n          \"\n        >\n          <cx-icon aria-hidden=\"true\" [type]=\"iconTypes.PENCIL\"></cx-icon>\n        </a>\n      </div>\n    </div>\n  </ng-template>\n\n  <!-- CART ITEM SECTION -->\n  <ng-container *ngIf=\"cart$ | async as cart\">\n    <div class=\"cx-review-cart-total d-none d-lg-block d-xl-block\">\n      {{\n        'cartItems.cartTotal'\n          | cxTranslate: { count: cart.deliveryItemsQuantity }\n      }}:\n      {{ cart.totalPrice?.formattedValue }}\n    </div>\n    <div class=\"cx-review-cart-heading d-block d-lg-none d-xl-none\">\n      {{ 'checkoutReview.placeOrder' | cxTranslate }}\n    </div>\n    <div class=\"cx-review-cart-item\" *ngIf=\"entries$ | async as entries\">\n      <cx-promotions\n        [promotions]=\"\n          (cart.appliedOrderPromotions || []).concat(\n            cart.potentialOrderPromotions || []\n          )\n        \"\n      ></cx-promotions>\n\n      <ng-template\n        [cxOutlet]=\"cartOutlets.CART_ITEM_LIST\"\n        [cxOutletContext]=\"{\n          items: entries,\n          readonly: true,\n          promotionLocation: promotionLocation\n        }\"\n      >\n      </ng-template>\n    </div>\n  </ng-container>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.CheckoutDeliveryAddressFacade }, { type: i1.CheckoutPaymentFacade }, { type: i2.ActiveCartFacade }, { type: i3.TranslationService }, { type: i4.CheckoutStepService }, { type: i1.CheckoutDeliveryModesFacade }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tvdXQtcmV2aWV3LXN1Ym1pdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvY2hlY2tvdXQvYmFzZS9jb21wb25lbnRzL2NoZWNrb3V0LXJldmlldy1zdWJtaXQvY2hlY2tvdXQtcmV2aWV3LXN1Ym1pdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvY2hlY2tvdXQvYmFzZS9jb21wb25lbnRzL2NoZWNrb3V0LXJldmlldy1zdWJtaXQvY2hlY2tvdXQtcmV2aWV3LXN1Ym1pdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRSxPQUFPLEVBR0wsV0FBVyxFQUlYLGlCQUFpQixHQUNsQixNQUFNLDJCQUEyQixDQUFDO0FBU25DLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzlFLE9BQU8sRUFBUSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsYUFBYSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQVE3QyxNQUFNLE9BQU8sNkJBQTZCO0lBVXhDLFlBQ1ksNkJBQTRELEVBQzVELHFCQUE0QyxFQUM1QyxnQkFBa0MsRUFDbEMsa0JBQXNDLEVBQ3RDLG1CQUF3QyxFQUN4QywyQkFBd0Q7UUFMeEQsa0NBQTZCLEdBQTdCLDZCQUE2QixDQUErQjtRQUM1RCwwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO1FBQzVDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFv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LENBQUMsY0FBYyxFQUFFLFVBQVU7eUJBQzFDO3FCQUNGO2lCQUNGO2FBQ00sQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRUQsa0JBQWtCLENBQUMsUUFBbUM7UUFDcEQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGVBQWUsQ0FDbkQsUUFBNEIsQ0FDN0IsQ0FBQztRQUNGLE9BQU8sSUFBSSxFQUFFLFNBQVMsQ0FBQztJQUN6QixDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQXFCO1FBQ2pDLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQzNCLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3ZELENBQUM7SUFDSixDQUFDO0lBRUQsWUFBWSxDQUFDLEtBQXFCO1FBQ2hDLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQzNCLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3RELENBQUM7SUFDSixDQUFDOzswSEE1SVUsNkJBQTZCOzhHQUE3Qiw2QkFBNkIsd0RDbkMxQyxnM0tBNkpBOzJGRDFIYSw2QkFBNkI7a0JBTHpDLFNBQVM7K0JBQ0Usa0JBQWtCLG1CQUVYLHVCQUF1QixDQUFDLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBBY3RpdmVDYXJ0RmFjYWRlLFxuICBDYXJ0LFxuICBDYXJ0T3V0bGV0cyxcbiAgRGVsaXZlcnlNb2RlLFxuICBPcmRlckVudHJ5LFxuICBQYXltZW50RGV0YWlscyxcbiAgUHJvbW90aW9uTG9jYXRpb24sXG59IGZyb20gJ0BzcGFydGFjdXMvY2FydC9iYXNlL3Jvb3QnO1xuaW1wb3J0IHtcbiAgQ2hlY2tvdXREZWxpdmVyeUFkZHJlc3NGYWNhZGUsXG4gIENoZWNrb3V0RGVsaXZlcnlNb2Rlc0ZhY2FkZSxcbiAgQ2hlY2tvdXRQYXltZW50RmFjYWRlLFxuICBDaGVja291dFN0ZXAsXG4gIENoZWNrb3V0U3RlcFR5cGUsXG59IGZyb20gJ0BzcGFydGFjdXMvY2hlY2tvdXQvYmFzZS9yb290JztcbmltcG9ydCB7IEFkZHJlc3MsIFRyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQgeyBkZWxpdmVyeUFkZHJlc3NDYXJkLCBkZWxpdmVyeU1vZGVDYXJkIH0gZnJvbSAnQHNwYXJ0YWN1cy9vcmRlci9yb290JztcbmltcG9ydCB7IENhcmQsIElDT05fVFlQRSB9IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmcm9udCc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENoZWNrb3V0U3RlcFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jaGVja291dC1zdGVwLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1yZXZpZXctc3VibWl0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NoZWNrb3V0LXJldmlldy1zdWJtaXQuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgQ2hlY2tvdXRSZXZpZXdTdWJtaXRDb21wb25lbnQge1xuICByZWFkb25seSBjYXJ0T3V0bGV0cyA9IENhcnRPdXRsZXRzO1xuICBpY29uVHlwZXMgPSBJQ09OX1RZUEU7XG5cbiAgY2hlY2tvdXRTdGVwVHlwZURlbGl2ZXJ5QWRkcmVzcyA9IENoZWNrb3V0U3RlcFR5cGUuREVMSVZFUllfQUREUkVTUztcbiAgY2hlY2tvdXRTdGVwVHlwZVBheW1lbnREZXRhaWxzID0gQ2hlY2tvdXRTdGVwVHlwZS5QQVlNRU5UX0RFVEFJTFM7XG4gIGNoZWNrb3V0U3RlcFR5cGVEZWxpdmVyeU1vZGUgPSBDaGVja291dFN0ZXBUeXBlLkRFTElWRVJZX01PREU7XG5cbiAgcHJvbW90aW9uTG9jYXRpb246IFByb21vdGlvbkxvY2F0aW9uID0gUHJvbW90aW9uTG9jYXRpb24uQWN0aXZlQ2FydDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY2hlY2tvdXREZWxpdmVyeUFkZHJlc3NGYWNhZGU6IENoZWNrb3V0RGVsaXZlcnlBZGRyZXNzRmFjYWRlLFxuICAgIHByb3RlY3RlZCBjaGVja291dFBheW1lbnRGYWNhZGU6IENoZWNrb3V0UGF5bWVudEZhY2FkZSxcbiAgICBwcm90ZWN0ZWQgYWN0aXZlQ2FydEZhY2FkZTogQWN0aXZlQ2FydEZhY2FkZSxcbiAgICBwcm90ZWN0ZWQgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNoZWNrb3V0U3RlcFNlcnZpY2U6IENoZWNrb3V0U3RlcFNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNoZWNrb3V0RGVsaXZlcnlNb2Rlc0ZhY2FkZTogQ2hlY2tvdXREZWxpdmVyeU1vZGVzRmFjYWRlXG4gICkge31cblxuICBnZXQgY2FydCQoKTogT2JzZXJ2YWJsZTxDYXJ0PiB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlQ2FydEZhY2FkZS5nZXRBY3RpdmUoKTtcbiAgfVxuXG4gIGdldCBlbnRyaWVzJCgpOiBPYnNlcnZhYmxlPE9yZGVyRW50cnlbXT4ge1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZUNhcnRGYWNhZGUuZ2V0RW50cmllcygpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENoZWNrb3V0RGVsaXZlcnlTdGVwcygpOiBBcnJheTxDaGVja291dFN0ZXBUeXBlIHwgc3RyaW5nPiB7XG4gICAgcmV0dXJuIFtDaGVja291dFN0ZXBUeXBlLkRFTElWRVJZX0FERFJFU1MsIENoZWNrb3V0U3RlcFR5cGUuREVMSVZFUllfTU9ERV07XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0Q2hlY2tvdXRQYXltZW50U3RlcHMoKTogQXJyYXk8Q2hlY2tvdXRTdGVwVHlwZSB8IHN0cmluZz4ge1xuICAgIHJldHVybiBbXG4gICAgICBDaGVja291dFN0ZXBUeXBlLlBBWU1FTlRfREVUQUlMUyxcbiAgICAgIENoZWNrb3V0U3RlcFR5cGUuREVMSVZFUllfQUREUkVTUyxcbiAgICBdO1xuICB9XG5cbiAgc3RlcHMkOiBPYnNlcnZhYmxlPENoZWNrb3V0U3RlcFtdPiA9IHRoaXMuY2hlY2tvdXRTdGVwU2VydmljZS5zdGVwcyQ7XG5cbiAgZGVsaXZlcnlBZGRyZXNzJDogT2JzZXJ2YWJsZTxBZGRyZXNzIHwgdW5kZWZpbmVkPiA9XG4gICAgdGhpcy5jaGVja291dERlbGl2ZXJ5QWRkcmVzc0ZhY2FkZS5nZXREZWxpdmVyeUFkZHJlc3NTdGF0ZSgpLnBpcGUoXG4gICAgICBmaWx0ZXIoKHN0YXRlKSA9PiAhc3RhdGUubG9hZGluZyAmJiAhc3RhdGUuZXJyb3IpLFxuICAgICAgbWFwKChzdGF0ZSkgPT4gc3RhdGUuZGF0YSlcbiAgICApO1xuXG4gIGRlbGl2ZXJ5TW9kZSQ6IE9ic2VydmFibGU8RGVsaXZlcnlNb2RlIHwgdW5kZWZpbmVkPiA9XG4gICAgdGhpcy5jaGVja291dERlbGl2ZXJ5TW9kZXNGYWNhZGUuZ2V0U2VsZWN0ZWREZWxpdmVyeU1vZGVTdGF0ZSgpLnBpcGUoXG4gICAgICBmaWx0ZXIoKHN0YXRlKSA9PiAhc3RhdGUubG9hZGluZyAmJiAhc3RhdGUuZXJyb3IpLFxuICAgICAgbWFwKChzdGF0ZSkgPT4gc3RhdGUuZGF0YSlcbiAgICApO1xuXG4gIHBheW1lbnREZXRhaWxzJDogT2JzZXJ2YWJsZTxQYXltZW50RGV0YWlscyB8IHVuZGVmaW5lZD4gPVxuICAgIHRoaXMuY2hlY2tvdXRQYXltZW50RmFjYWRlLmdldFBheW1lbnREZXRhaWxzU3RhdGUoKS5waXBlKFxuICAgICAgZmlsdGVyKChzdGF0ZSkgPT4gIXN0YXRlLmxvYWRpbmcgJiYgIXN0YXRlLmVycm9yKSxcbiAgICAgIG1hcCgoc3RhdGUpID0+IHN0YXRlLmRhdGEpXG4gICAgKTtcblxuICBnZXREZWxpdmVyeUFkZHJlc3NDYXJkKFxuICAgIGRlbGl2ZXJ5QWRkcmVzczogQWRkcmVzcyxcbiAgICBjb3VudHJ5TmFtZT86IHN0cmluZ1xuICApOiBPYnNlcnZhYmxlPENhcmQ+IHtcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS50cmFuc2xhdGUoJ2FkZHJlc3NDYXJkLnNoaXBUbycpLFxuICAgICAgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdhZGRyZXNzQ2FyZC5waG9uZU51bWJlcicpLFxuICAgICAgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdhZGRyZXNzQ2FyZC5tb2JpbGVOdW1iZXInKSxcbiAgICBdKS5waXBlKFxuICAgICAgbWFwKChbdGV4dFRpdGxlLCB0ZXh0UGhvbmUsIHRleHRNb2JpbGVdKSA9PlxuICAgICAgICBkZWxpdmVyeUFkZHJlc3NDYXJkKFxuICAgICAgICAgIHRleHRUaXRsZSxcbiAgICAgICAgICB0ZXh0UGhvbmUsXG4gICAgICAgICAgdGV4dE1vYmlsZSxcbiAgICAgICAgICBkZWxpdmVyeUFkZHJlc3MsXG4gICAgICAgICAgY291bnRyeU5hbWVcbiAgICAgICAgKVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBnZXREZWxpdmVyeU1vZGVDYXJkKGRlbGl2ZXJ5TW9kZTogRGVsaXZlcnlNb2RlKTogT2JzZXJ2YWJsZTxDYXJkPiB7XG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdjaGVja291dE1vZGUuZGVsaXZlcnlNZXRob2QnKSxcbiAgICBdKS5waXBlKG1hcCgoW3RleHRUaXRsZV0pID0+IGRlbGl2ZXJ5TW9kZUNhcmQodGV4dFRpdGxlLCBkZWxpdmVyeU1vZGUpKSk7XG4gIH1cblxuICBnZXRQYXltZW50TWV0aG9kQ2FyZChwYXltZW50RGV0YWlsczogUGF5bWVudERldGFpbHMpOiBPYnNlcnZhYmxlPENhcmQ+IHtcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS50cmFuc2xhdGUoJ3BheW1lbnRGb3JtLnBheW1lbnQnKSxcbiAgICAgIHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLnRyYW5zbGF0ZSgncGF5bWVudENhcmQuZXhwaXJlcycsIHtcbiAgICAgICAgbW9udGg6IHBheW1lbnREZXRhaWxzLmV4cGlyeU1vbnRoLFxuICAgICAgICB5ZWFyOiBwYXltZW50RGV0YWlscy5leHBpcnlZZWFyLFxuICAgICAgfSksXG4gICAgICB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS50cmFuc2xhdGUoJ3BheW1lbnRGb3JtLmJpbGxpbmdBZGRyZXNzJyksXG4gICAgXSkucGlwZShcbiAgICAgIG1hcCgoW3RleHRUaXRsZSwgdGV4dEV4cGlyZXMsIGJpbGxpbmdBZGRyZXNzXSkgPT4ge1xuICAgICAgICBjb25zdCByZWdpb24gPSBwYXltZW50RGV0YWlscy5iaWxsaW5nQWRkcmVzcz8ucmVnaW9uPy5pc29jb2RlXG4gICAgICAgICAgPyBwYXltZW50RGV0YWlscy5iaWxsaW5nQWRkcmVzcz8ucmVnaW9uPy5pc29jb2RlICsgJywgJ1xuICAgICAgICAgIDogJyc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICB0ZXh0Qm9sZDogcGF5bWVudERldGFpbHMuYWNjb3VudEhvbGRlck5hbWUsXG4gICAgICAgICAgdGV4dDogW3BheW1lbnREZXRhaWxzLmNhcmROdW1iZXIsIHRleHRFeHBpcmVzXSxcbiAgICAgICAgICBwYXJhZ3JhcGhzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBiaWxsaW5nQWRkcmVzcyArICc6JyxcbiAgICAgICAgICAgICAgdGV4dDogW1xuICAgICAgICAgICAgICAgIHBheW1lbnREZXRhaWxzLmJpbGxpbmdBZGRyZXNzPy5maXJzdE5hbWUgK1xuICAgICAgICAgICAgICAgICAgJyAnICtcbiAgICAgICAgICAgICAgICAgIHBheW1lbnREZXRhaWxzLmJpbGxpbmdBZGRyZXNzPy5sYXN0TmFtZSxcbiAgICAgICAgICAgICAgICBwYXltZW50RGV0YWlscy5iaWxsaW5nQWRkcmVzcz8ubGluZTEsXG4gICAgICAgICAgICAgICAgcGF5bWVudERldGFpbHMuYmlsbGluZ0FkZHJlc3M/LnRvd24gK1xuICAgICAgICAgICAgICAgICAgJywgJyArXG4gICAgICAgICAgICAgICAgICByZWdpb24gK1xuICAgICAgICAgICAgICAgICAgcGF5bWVudERldGFpbHMuYmlsbGluZ0FkZHJlc3M/LmNvdW50cnk/Lmlzb2NvZGUsXG4gICAgICAgICAgICAgICAgcGF5bWVudERldGFpbHMuYmlsbGluZ0FkZHJlc3M/LnBvc3RhbENvZGUsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0gYXMgQ2FyZDtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGdldENoZWNrb3V0U3RlcFVybChzdGVwVHlwZTogQ2hlY2tvdXRTdGVwVHlwZSB8IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3Qgc3RlcCA9IHRoaXMuY2hlY2tvdXRTdGVwU2VydmljZS5nZXRDaGVja291dFN0ZXAoXG4gICAgICBzdGVwVHlwZSBhcyBDaGVja291dFN0ZXBUeXBlXG4gICAgKTtcbiAgICByZXR1cm4gc3RlcD8ucm91dGVOYW1lO1xuICB9XG5cbiAgZGVsaXZlcnlTdGVwcyhzdGVwczogQ2hlY2tvdXRTdGVwW10pOiBDaGVja291dFN0ZXBbXSB7XG4gICAgcmV0dXJuIHN0ZXBzLmZpbHRlcigoc3RlcCkgPT5cbiAgICAgIHRoaXMuZ2V0Q2hlY2tvdXREZWxpdmVyeVN0ZXBzKCkuaW5jbHVkZXMoc3RlcC50eXBlWzBdKVxuICAgICk7XG4gIH1cblxuICBwYXltZW50U3RlcHMoc3RlcHM6IENoZWNrb3V0U3RlcFtdKTogQ2hlY2tvdXRTdGVwW10ge1xuICAgIHJldHVybiBzdGVwcy5maWx0ZXIoKHN0ZXApID0+XG4gICAgICB0aGlzLmdldENoZWNrb3V0UGF5bWVudFN0ZXBzKCkuaW5jbHVkZXMoc3RlcC50eXBlWzBdKVxuICAgICk7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJjeC1yZXZpZXdcIj5cbiAgPCEtLSBUSVRMRSAtLT5cbiAgPGgyIGNsYXNzPVwiY3gtcmV2aWV3LXRpdGxlIGQtbm9uZSBkLWxnLWJsb2NrIGQteGwtYmxvY2tcIj5cbiAgICB7eyAnY2hlY2tvdXRSZXZpZXcucmV2aWV3JyB8IGN4VHJhbnNsYXRlIH19XG4gIDwvaDI+XG5cbiAgPGRpdiBjbGFzcz1cImN4LXJldmlldy1zdW1tYXJ5IHJvd1wiPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIoc3RlcHMkIHwgYXN5bmMpPy5zbGljZSgwLCAtMSkgYXMgc3RlcHNcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtMTIgY29sLWxnLTYgY29sLXhsLTYgY3gtcmV2aWV3LXBheW1lbnQtY29sXCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHN0ZXAgb2YgcGF5bWVudFN0ZXBzKHN0ZXBzKVwiPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgW25nU3dpdGNoXT1cInN0ZXAudHlwZVswXVwiPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiY2hlY2tvdXRTdGVwVHlwZVBheW1lbnREZXRhaWxzXCI+XG4gICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJwYXltZW50TWV0aG9kXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtMTIgY29sLWxnLTYgY29sLXhsLTYgY3gtcmV2aWV3LXNoaXBwaW5nLWNvbFwiPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBzdGVwIG9mIGRlbGl2ZXJ5U3RlcHMoc3RlcHMpXCI+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lciBbbmdTd2l0Y2hdPVwic3RlcC50eXBlWzBdXCI+XG4gICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJjaGVja291dFN0ZXBUeXBlRGVsaXZlcnlBZGRyZXNzXCI+XG4gICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJkZWxpdmVyeUFkZHJlc3NcIj48L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiY2hlY2tvdXRTdGVwVHlwZURlbGl2ZXJ5TW9kZVwiPlxuICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiZGVsaXZlcnlNb2RlXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9kaXY+XG5cbiAgPCEtLSBERUxJVkVSWSBBRERSRVNTIFNFQ1RJT04gLS0+XG4gIDxuZy10ZW1wbGF0ZSAjZGVsaXZlcnlBZGRyZXNzPlxuICAgIDxkaXZcbiAgICAgICpuZ0lmPVwiZGVsaXZlcnlBZGRyZXNzJCB8IGFzeW5jIGFzIGRlbGl2ZXJ5QWRkcmVzc1wiXG4gICAgICBjbGFzcz1cImN4LXJldmlldy1zdW1tYXJ5LWNhcmQgY3gtcmV2aWV3LWNhcmQtYWRkcmVzc1wiXG4gICAgPlxuICAgICAgPGN4LWNhcmRcbiAgICAgICAgW2NvbnRlbnRdPVwiZ2V0RGVsaXZlcnlBZGRyZXNzQ2FyZChkZWxpdmVyeUFkZHJlc3MpIHwgYXN5bmNcIlxuICAgICAgPjwvY3gtY2FyZD5cbiAgICAgIDxkaXYgY2xhc3M9XCJjeC1yZXZpZXctc3VtbWFyeS1lZGl0LXN0ZXBcIj5cbiAgICAgICAgPGFcbiAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgJ2NoZWNrb3V0UmV2aWV3LmVkaXREZWxpdmVyeUFkZHJlc3NEZXRhaWxzJyB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgXCJcbiAgICAgICAgICBbcm91dGVyTGlua109XCJcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgY3hSb3V0ZTogZ2V0Q2hlY2tvdXRTdGVwVXJsKGNoZWNrb3V0U3RlcFR5cGVEZWxpdmVyeUFkZHJlc3MpXG4gICAgICAgICAgICB9IHwgY3hVcmxcbiAgICAgICAgICBcIlxuICAgICAgICAgID48Y3gtaWNvbiBhcmlhLWhpZGRlbj1cInRydWVcIiBbdHlwZV09XCJpY29uVHlwZXMuUEVOQ0lMXCI+PC9jeC1pY29uXG4gICAgICAgID48L2E+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9uZy10ZW1wbGF0ZT5cblxuICA8IS0tIERFTElWRVJZIE1PREUgU0VDVElPTiAtLT5cbiAgPG5nLXRlbXBsYXRlICNkZWxpdmVyeU1vZGU+XG4gICAgPGRpdiBjbGFzcz1cImN4LXJldmlldy1zdW1tYXJ5LWNhcmQgY3gtcmV2aWV3LWNhcmQtc2hpcHBpbmdcIj5cbiAgICAgIDwhLS0gVE9ETzooQ1hJTlQtMjMwOSkgZm9yIG5leHQgbWFqb3IgcmVsZWFzZSByZW1vdmUgZmVhdHVyZSBsZXZlbCAtLT5cbiAgICAgIDxuZy1jb250YWluZXIgKmN4RmVhdHVyZUxldmVsPVwiJyE2LjQnXCI+XG4gICAgICAgIDxjeC1jYXJkXG4gICAgICAgICAgKm5nSWY9XCJkZWxpdmVyeU1vZGUkIHwgYXN5bmMgYXMgZGVsaXZlcnlNb2RlXCJcbiAgICAgICAgICBbY29udGVudF09XCJnZXREZWxpdmVyeU1vZGVDYXJkKGRlbGl2ZXJ5TW9kZSkgfCBhc3luY1wiXG4gICAgICAgID5cbiAgICAgICAgPC9jeC1jYXJkPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8IS0tIFRPRE86KENYSU5ULTIzMDkpIGZvciBuZXh0IG1ham9yIHJlbGVhc2UgcmVtb3ZlIGZlYXR1cmUgbGV2ZWwgLS0+XG4gICAgICA8bmctY29udGFpbmVyICpjeEZlYXR1cmVMZXZlbD1cIic2LjQnXCI+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPGN4LWNhcmRcbiAgICAgICAgICAgICpuZ0lmPVwiZGVsaXZlcnlNb2RlJCB8IGFzeW5jIGFzIGRlbGl2ZXJ5TW9kZVwiXG4gICAgICAgICAgICBbY29udGVudF09XCJnZXREZWxpdmVyeU1vZGVDYXJkKGRlbGl2ZXJ5TW9kZSkgfCBhc3luY1wiXG4gICAgICAgICAgPlxuICAgICAgICAgIDwvY3gtY2FyZD5cbiAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgIFtjeE91dGxldF09XCJjYXJ0T3V0bGV0cy5ERUxJVkVSWV9NT0RFXCJcbiAgICAgICAgICAgIFtjeE91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgICAgICBpdGVtOiBjYXJ0JCB8IGFzeW5jLFxuICAgICAgICAgICAgICByZWFkb25seTogdHJ1ZVxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgPlxuICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgIDxkaXYgY2xhc3M9XCJjeC1yZXZpZXctc3VtbWFyeS1lZGl0LXN0ZXBcIj5cbiAgICAgICAgPGFcbiAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIidjaGVja291dFJldmlldy5lZGl0RGVsaXZlcnlNb2RlJyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgICAgICBbcm91dGVyTGlua109XCJcbiAgICAgICAgICAgIHsgY3hSb3V0ZTogZ2V0Q2hlY2tvdXRTdGVwVXJsKGNoZWNrb3V0U3RlcFR5cGVEZWxpdmVyeU1vZGUpIH1cbiAgICAgICAgICAgICAgfCBjeFVybFxuICAgICAgICAgIFwiXG4gICAgICAgID5cbiAgICAgICAgICA8Y3gtaWNvbiBhcmlhLWhpZGRlbj1cInRydWVcIiBbdHlwZV09XCJpY29uVHlwZXMuUEVOQ0lMXCI+PC9jeC1pY29uPlxuICAgICAgICA8L2E+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9uZy10ZW1wbGF0ZT5cblxuICA8IS0tIFBBWU1FTlQgTUVUSE9EIFNFQ1RJT04gLS0+XG4gIDxuZy10ZW1wbGF0ZSAjcGF5bWVudE1ldGhvZD5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtcmV2aWV3LXN1bW1hcnktY2FyZCBjeC1yZXZpZXctY2FyZC1wYXltZW50XCI+XG4gICAgICA8ZGl2PlxuICAgICAgICA8Y3gtY2FyZFxuICAgICAgICAgICpuZ0lmPVwicGF5bWVudERldGFpbHMkIHwgYXN5bmMgYXMgcGF5bWVudERldGFpbHNcIlxuICAgICAgICAgIFtjb250ZW50XT1cImdldFBheW1lbnRNZXRob2RDYXJkKHBheW1lbnREZXRhaWxzKSB8IGFzeW5jXCJcbiAgICAgICAgPjwvY3gtY2FyZD5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImN4LXJldmlldy1zdW1tYXJ5LWVkaXQtc3RlcFwiPlxuICAgICAgICA8YVxuICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiJ2NoZWNrb3V0UmV2aWV3LmVkaXRQYXltZW50RGV0YWlscycgfCBjeFRyYW5zbGF0ZVwiXG4gICAgICAgICAgW3JvdXRlckxpbmtdPVwiXG4gICAgICAgICAgICB7IGN4Um91dGU6IGdldENoZWNrb3V0U3RlcFVybChjaGVja291dFN0ZXBUeXBlUGF5bWVudERldGFpbHMpIH1cbiAgICAgICAgICAgICAgfCBjeFVybFxuICAgICAgICAgIFwiXG4gICAgICAgID5cbiAgICAgICAgICA8Y3gtaWNvbiBhcmlhLWhpZGRlbj1cInRydWVcIiBbdHlwZV09XCJpY29uVHlwZXMuUEVOQ0lMXCI+PC9jeC1pY29uPlxuICAgICAgICA8L2E+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9uZy10ZW1wbGF0ZT5cblxuICA8IS0tIENBUlQgSVRFTSBTRUNUSU9OIC0tPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiY2FydCQgfCBhc3luYyBhcyBjYXJ0XCI+XG4gICAgPGRpdiBjbGFzcz1cImN4LXJldmlldy1jYXJ0LXRvdGFsIGQtbm9uZSBkLWxnLWJsb2NrIGQteGwtYmxvY2tcIj5cbiAgICAgIHt7XG4gICAgICAgICdjYXJ0SXRlbXMuY2FydFRvdGFsJ1xuICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgY291bnQ6IGNhcnQuZGVsaXZlcnlJdGVtc1F1YW50aXR5IH1cbiAgICAgIH19OlxuICAgICAge3sgY2FydC50b3RhbFByaWNlPy5mb3JtYXR0ZWRWYWx1ZSB9fVxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjeC1yZXZpZXctY2FydC1oZWFkaW5nIGQtYmxvY2sgZC1sZy1ub25lIGQteGwtbm9uZVwiPlxuICAgICAge3sgJ2NoZWNrb3V0UmV2aWV3LnBsYWNlT3JkZXInIHwgY3hUcmFuc2xhdGUgfX1cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtcmV2aWV3LWNhcnQtaXRlbVwiICpuZ0lmPVwiZW50cmllcyQgfCBhc3luYyBhcyBlbnRyaWVzXCI+XG4gICAgICA8Y3gtcHJvbW90aW9uc1xuICAgICAgICBbcHJvbW90aW9uc109XCJcbiAgICAgICAgICAoY2FydC5hcHBsaWVkT3JkZXJQcm9tb3Rpb25zIHx8IFtdKS5jb25jYXQoXG4gICAgICAgICAgICBjYXJ0LnBvdGVudGlhbE9yZGVyUHJvbW90aW9ucyB8fCBbXVxuICAgICAgICAgIClcbiAgICAgICAgXCJcbiAgICAgID48L2N4LXByb21vdGlvbnM+XG5cbiAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICBbY3hPdXRsZXRdPVwiY2FydE91dGxldHMuQ0FSVF9JVEVNX0xJU1RcIlxuICAgICAgICBbY3hPdXRsZXRDb250ZXh0XT1cIntcbiAgICAgICAgICBpdGVtczogZW50cmllcyxcbiAgICAgICAgICByZWFkb25seTogdHJ1ZSxcbiAgICAgICAgICBwcm9tb3Rpb25Mb2NhdGlvbjogcHJvbW90aW9uTG9jYXRpb25cbiAgICAgICAgfVwiXG4gICAgICA+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgIDwvZGl2PlxuICA8L25nLWNvbnRhaW5lcj5cbjwvZGl2PlxuIl19