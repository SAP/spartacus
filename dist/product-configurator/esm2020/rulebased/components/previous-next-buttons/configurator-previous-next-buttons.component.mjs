/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { delay, filter, map, switchMap, take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../../core/facade/configurator-groups.service";
import * as i2 from "../../core/facade/configurator-commons.service";
import * as i3 from "@spartacus/product-configurator/common";
import * as i4 from "../service/configurator-storefront-utils.service";
import * as i5 from "@angular/common";
import * as i6 from "@spartacus/core";
export class ConfiguratorPreviousNextButtonsComponent {
    constructor(configuratorGroupsService, configuratorCommonsService, configRouterExtractorService, configUtils) {
        this.configuratorGroupsService = configuratorGroupsService;
        this.configuratorCommonsService = configuratorCommonsService;
        this.configRouterExtractorService = configRouterExtractorService;
        this.configUtils = configUtils;
        this.configuration$ = this.configRouterExtractorService
            .extractRouterData()
            .pipe(switchMap((routerData) => this.configuratorCommonsService.getConfiguration(routerData.owner)));
    }
    onPrevious(configuration) {
        this.configuratorGroupsService
            .getPreviousGroupId(configuration.owner)
            .pipe(take(1))
            .subscribe((groupId) => {
            if (groupId) {
                this.configuratorGroupsService.navigateToGroup(configuration, groupId);
                this.focusFirstAttribute();
            }
        });
        this.configUtils.scrollToConfigurationElement('.VariantConfigurationTemplate, .CpqConfigurationTemplate');
    }
    onNext(configuration) {
        this.configuratorGroupsService
            .getNextGroupId(configuration.owner)
            .pipe(take(1))
            .subscribe((groupId) => {
            if (groupId) {
                this.configuratorGroupsService.navigateToGroup(configuration, groupId);
                this.focusFirstAttribute();
            }
        });
        this.configUtils.scrollToConfigurationElement('.VariantConfigurationTemplate, .CpqConfigurationTemplate');
    }
    isFirstGroup(owner) {
        return this.configuratorGroupsService
            .getPreviousGroupId(owner)
            .pipe(map((group) => !group));
    }
    isLastGroup(owner) {
        return this.configuratorGroupsService
            .getNextGroupId(owner)
            .pipe(map((group) => !group));
    }
    focusFirstAttribute() {
        this.configRouterExtractorService
            .extractRouterData()
            .pipe(switchMap((routerData) => this.configuratorCommonsService
            .isConfigurationLoading(routerData.owner)
            .pipe(filter((isLoading) => isLoading), take(1), switchMap(() => this.configuratorCommonsService
            .isConfigurationLoading(routerData.owner)
            .pipe(filter((isLoading) => !isLoading), take(1), delay(0) //we need to consider the re-rendering of the page
        )))))
            .subscribe(() => this.configUtils.focusFirstAttribute());
    }
}
ConfiguratorPreviousNextButtonsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorPreviousNextButtonsComponent, deps: [{ token: i1.ConfiguratorGroupsService }, { token: i2.ConfiguratorCommonsService }, { token: i3.ConfiguratorRouterExtractorService }, { token: i4.ConfiguratorStorefrontUtilsService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorPreviousNextButtonsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorPreviousNextButtonsComponent, selector: "cx-configurator-previous-next-buttons", ngImport: i0, template: "<ng-container *ngIf=\"configuration$ | async as configuration\">\n  <ng-container *ngIf=\"configuration.groups.length > 1\">\n    <button\n      class=\"btn btn-block btn-secondary cx-previous\"\n      [disabled]=\"isFirstGroup(configuration.owner) | async\"\n      (click)=\"onPrevious(configuration)\"\n      [attr.aria-label]=\"'configurator.a11y.previous' | cxTranslate\"\n    >\n      {{ 'configurator.button.previous' | cxTranslate }}\n    </button>\n    <button\n      class=\"btn btn-block btn-secondary cx-next\"\n      [disabled]=\"isLastGroup(configuration.owner) | async\"\n      (click)=\"onNext(configuration)\"\n      [attr.aria-label]=\"'configurator.a11y.next' | cxTranslate\"\n    >\n      {{ 'configurator.button.next' | cxTranslate }}\n    </button>\n  </ng-container>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i5.AsyncPipe, name: "async" }, { kind: "pipe", type: i6.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorPreviousNextButtonsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-previous-next-buttons', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container *ngIf=\"configuration$ | async as configuration\">\n  <ng-container *ngIf=\"configuration.groups.length > 1\">\n    <button\n      class=\"btn btn-block btn-secondary cx-previous\"\n      [disabled]=\"isFirstGroup(configuration.owner) | async\"\n      (click)=\"onPrevious(configuration)\"\n      [attr.aria-label]=\"'configurator.a11y.previous' | cxTranslate\"\n    >\n      {{ 'configurator.button.previous' | cxTranslate }}\n    </button>\n    <button\n      class=\"btn btn-block btn-secondary cx-next\"\n      [disabled]=\"isLastGroup(configuration.owner) | async\"\n      (click)=\"onNext(configuration)\"\n      [attr.aria-label]=\"'configurator.a11y.next' | cxTranslate\"\n    >\n      {{ 'configurator.button.next' | cxTranslate }}\n    </button>\n  </ng-container>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorGroupsService }, { type: i2.ConfiguratorCommonsService }, { type: i3.ConfiguratorRouterExtractorService }, { type: i4.ConfiguratorStorefrontUtilsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLXByZXZpb3VzLW5leHQtYnV0dG9ucy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC1jb25maWd1cmF0b3IvcnVsZWJhc2VkL2NvbXBvbmVudHMvcHJldmlvdXMtbmV4dC1idXR0b25zL2NvbmZpZ3VyYXRvci1wcmV2aW91cy1uZXh0LWJ1dHRvbnMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL3ByZXZpb3VzLW5leHQtYnV0dG9ucy9jb25maWd1cmF0b3ItcHJldmlvdXMtbmV4dC1idXR0b25zLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBTW5FLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7O0FBV3JFLE1BQU0sT0FBTyx3Q0FBd0M7SUFVbkQsWUFDWSx5QkFBb0QsRUFDcEQsMEJBQXNELEVBQ3RELDRCQUFnRSxFQUNoRSxXQUErQztRQUgvQyw4QkFBeUIsR0FBekIseUJBQXlCLENBQTJCO1FBQ3BELCtCQUEwQixHQUExQiwwQkFBMEIsQ0FBNEI7UUFDdEQsaUNBQTRCLEdBQTVCLDRCQUE0QixDQUFvQztRQUNoRSxnQkFBVyxHQUFYLFdBQVcsQ0FBb0M7UUFiM0QsbUJBQWMsR0FDWixJQUFJLENBQUMsNEJBQTRCO2FBQzlCLGlCQUFpQixFQUFFO2FBQ25CLElBQUksQ0FDSCxTQUFTLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUN2QixJQUFJLENBQUMsMEJBQTBCLENBQUMsZ0JB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c0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQ29tbW9uQ29uZmlndXJhdG9yLFxuICBDb25maWd1cmF0b3JSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL3Byb2R1Y3QtY29uZmlndXJhdG9yL2NvbW1vbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWxheSwgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9mYWNhZGUvY29uZmlndXJhdG9yLWNvbW1vbnMuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JHcm91cHNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9mYWNhZGUvY29uZmlndXJhdG9yLWdyb3Vwcy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvciB9IGZyb20gJy4uLy4uL2NvcmUvbW9kZWwvY29uZmlndXJhdG9yLm1vZGVsJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvclN0b3JlZnJvbnRVdGlsc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2NvbmZpZ3VyYXRvci1zdG9yZWZyb250LXV0aWxzLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3ItcHJldmlvdXMtbmV4dC1idXR0b25zJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbmZpZ3VyYXRvci1wcmV2aW91cy1uZXh0LWJ1dHRvbnMuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgQ29uZmlndXJhdG9yUHJldmlvdXNOZXh0QnV0dG9uc0NvbXBvbmVudCB7XG4gIGNvbmZpZ3VyYXRpb24kOiBPYnNlcnZhYmxlPENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uPiA9XG4gICAgdGhpcy5jb25maWdSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlXG4gICAgICAuZXh0cmFjdFJvdXRlckRhdGEoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgocm91dGVyRGF0YSkgPT5cbiAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLmdldENvbmZpZ3VyYXRpb24ocm91dGVyRGF0YS5vd25lcilcbiAgICAgICAgKVxuICAgICAgKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJhdG9yR3JvdXBzU2VydmljZTogQ29uZmlndXJhdG9yR3JvdXBzU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2U6IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBjb25maWdSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlOiBDb25maWd1cmF0b3JSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBjb25maWdVdGlsczogQ29uZmlndXJhdG9yU3RvcmVmcm9udFV0aWxzU2VydmljZVxuICApIHt9XG5cbiAgb25QcmV2aW91cyhjb25maWd1cmF0aW9uOiBDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlndXJhdG9yR3JvdXBzU2VydmljZVxuICAgICAgLmdldFByZXZpb3VzR3JvdXBJZChjb25maWd1cmF0aW9uLm93bmVyKVxuICAgICAgLnBpcGUodGFrZSgxKSlcbiAgICAgIC5zdWJzY3JpYmUoKGdyb3VwSWQpID0+IHtcbiAgICAgICAgaWYgKGdyb3VwSWQpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2UubmF2aWdhdGVUb0dyb3VwKFxuICAgICAgICAgICAgY29uZmlndXJhdGlvbixcbiAgICAgICAgICAgIGdyb3VwSWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMuZm9jdXNGaXJzdEF0dHJpYnV0ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIHRoaXMuY29uZmlnVXRpbHMuc2Nyb2xsVG9Db25maWd1cmF0aW9uRWxlbWVudChcbiAgICAgICcuVmFyaWFudENvbmZpZ3VyYXRpb25UZW1wbGF0ZSwgLkNwcUNvbmZpZ3VyYXRpb25UZW1wbGF0ZSdcbiAgICApO1xuICB9XG5cbiAgb25OZXh0KGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uKTogdm9pZCB7XG4gICAgdGhpcy5jb25maWd1cmF0b3JHcm91cHNTZXJ2aWNlXG4gICAgICAuZ2V0TmV4dEdyb3VwSWQoY29uZmlndXJhdGlvbi5vd25lcilcbiAgICAgIC5waXBlKHRha2UoMSkpXG4gICAgICAuc3Vic2NyaWJlKChncm91cElkKSA9PiB7XG4gICAgICAgIGlmIChncm91cElkKSB7XG4gICAgICAgICAgdGhpcy5jb25maWd1cmF0b3JHcm91cHNTZXJ2aWNlLm5hdmlnYXRlVG9Hcm91cChcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICBncm91cElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLmZvY3VzRmlyc3RBdHRyaWJ1dGUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB0aGlzLmNvbmZpZ1V0aWxzLnNjcm9sbFRvQ29uZmlndXJhdGlvbkVsZW1lbnQoXG4gICAgICAnLlZhcmlhbnRDb25maWd1cmF0aW9uVGVtcGxhdGUsIC5DcHFDb25maWd1cmF0aW9uVGVtcGxhdGUnXG4gICAgKTtcbiAgfVxuXG4gIGlzRmlyc3RHcm91cChvd25lcjogQ29tbW9uQ29uZmlndXJhdG9yLk93bmVyKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlndXJhdG9yR3JvdXBzU2VydmljZVxuICAgICAgLmdldFByZXZpb3VzR3JvdXBJZChvd25lcilcbiAgICAgIC5waXBlKG1hcCgoZ3JvdXApID0+ICFncm91cCkpO1xuICB9XG5cbiAgaXNMYXN0R3JvdXAob3duZXI6IENvbW1vbkNvbmZpZ3VyYXRvci5Pd25lcik6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2VcbiAgICAgIC5nZXROZXh0R3JvdXBJZChvd25lcilcbiAgICAgIC5waXBlKG1hcCgoZ3JvdXApID0+ICFncm91cCkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGZvY3VzRmlyc3RBdHRyaWJ1dGUoKTogdm9pZCB7XG4gICAgdGhpcy5jb25maWdSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlXG4gICAgICAuZXh0cmFjdFJvdXRlckRhdGEoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgocm91dGVyRGF0YSkgPT5cbiAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlXG4gICAgICAgICAgICAuaXNDb25maWd1cmF0aW9uTG9hZGluZyhyb3V0ZXJEYXRhLm93bmVyKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIGZpbHRlcigoaXNMb2FkaW5nKSA9PiBpc0xvYWRpbmcpLFxuICAgICAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlXG4gICAgICAgICAgICAgICAgICAuaXNDb25maWd1cmF0aW9uTG9hZGluZyhyb3V0ZXJEYXRhLm93bmVyKVxuICAgICAgICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcigoaXNMb2FkaW5nKSA9PiAhaXNMb2FkaW5nKSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICAgICAgICAgICAgZGVsYXkoMCkgLy93ZSBuZWVkIHRvIGNvbnNpZGVyIHRoZSByZS1yZW5kZXJpbmcgb2YgdGhlIHBhZ2VcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuY29uZmlnVXRpbHMuZm9jdXNGaXJzdEF0dHJpYnV0ZSgpKTtcbiAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cImNvbmZpZ3VyYXRpb24kIHwgYXN5bmMgYXMgY29uZmlndXJhdGlvblwiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiY29uZmlndXJhdGlvbi5ncm91cHMubGVuZ3RoID4gMVwiPlxuICAgIDxidXR0b25cbiAgICAgIGNsYXNzPVwiYnRuIGJ0bi1ibG9jayBidG4tc2Vjb25kYXJ5IGN4LXByZXZpb3VzXCJcbiAgICAgIFtkaXNhYmxlZF09XCJpc0ZpcnN0R3JvdXAoY29uZmlndXJhdGlvbi5vd25lcikgfCBhc3luY1wiXG4gICAgICAoY2xpY2spPVwib25QcmV2aW91cyhjb25maWd1cmF0aW9uKVwiXG4gICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIidjb25maWd1cmF0b3IuYTExeS5wcmV2aW91cycgfCBjeFRyYW5zbGF0ZVwiXG4gICAgPlxuICAgICAge3sgJ2NvbmZpZ3VyYXRvci5idXR0b24ucHJldmlvdXMnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICA8L2J1dHRvbj5cbiAgICA8YnV0dG9uXG4gICAgICBjbGFzcz1cImJ0biBidG4tYmxvY2sgYnRuLXNlY29uZGFyeSBjeC1uZXh0XCJcbiAgICAgIFtkaXNhYmxlZF09XCJpc0xhc3RHcm91cChjb25maWd1cmF0aW9uLm93bmVyKSB8IGFzeW5jXCJcbiAgICAgIChjbGljayk9XCJvbk5leHQoY29uZmlndXJhdGlvbilcIlxuICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCInY29uZmlndXJhdG9yLmExMXkubmV4dCcgfCBjeFRyYW5zbGF0ZVwiXG4gICAgPlxuICAgICAge3sgJ2NvbmZpZ3VyYXRvci5idXR0b24ubmV4dCcgfCBjeFRyYW5zbGF0ZSB9fVxuICAgIDwvYnV0dG9uPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctY29udGFpbmVyPlxuIl19