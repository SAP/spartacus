/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, Input, } from '@angular/core';
import { isNotUndefined } from '@spartacus/core';
import { filter, map, switchMap, tap } from 'rxjs/operators';
import { CurrentItemService } from '../../shared/current-item.service';
import { ItemService } from '../../shared/item.service';
import { createCodeForEntityName } from '../../shared/utility/entity-code';
import { CurrentUnitService } from '../services/current-unit.service';
import { UnitItemService } from '../services/unit-item.service';
import * as i0 from "@angular/core";
import * as i1 from "../../shared/item.service";
import * as i2 from "@spartacus/organization/administration/core";
import * as i3 from "@angular/common";
import * as i4 from "../../shared/form/form.component";
import * as i5 from "@ng-select/ng-select";
import * as i6 from "@angular/forms";
import * as i7 from "@spartacus/storefront";
import * as i8 from "@spartacus/core";
export class UnitFormComponent {
    constructor(itemService, unitService) {
        this.itemService = itemService;
        this.unitService = unitService;
        this.i18nRoot = 'orgUnit';
        this.createChildUnit = false;
        this.form = this.itemService.getForm();
        this.units$ = this.itemService.unit$.pipe(tap((unit) => {
            this.form?.get('parentOrgUnit.uid')?.setValue(unit);
            if (this.createChildUnit) {
                this.form?.get('parentOrgUnit')?.disable();
            }
        }), switchMap(() => this.unitService.getActiveUnitList().pipe(map((units) => units?.filter((unit) => unit.id !== this.form?.value.uid)), tap((units) => {
            if (units && units.length === 1) {
                this.form?.get('parentOrgUnit.uid')?.setValue(units[0]?.id);
            }
        }))));
        this.approvalProcess$ = this.unitService
            .getApprovalProcesses()
            .pipe(filter(isNotUndefined), filter((items) => items.length > 0));
    }
    ngOnInit() {
        this.unitService.loadList();
    }
    createUidWithName(name, code) {
        createCodeForEntityName(name, code);
    }
}
UnitFormComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: UnitFormComponent, deps: [{ token: i1.ItemService }, { token: i2.OrgUnitService }], target: i0.ɵɵFactoryTarget.Component });
UnitFormComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: UnitFormComponent, selector: "cx-org-unit-form", inputs: { i18nRoot: "i18nRoot", createChildUnit: "createChildUnit" }, host: { classAttribute: "content-wrapper" }, providers: [
        {
            provide: ItemService,
            useExisting: UnitItemService,
        },
        {
            provide: CurrentItemService,
            useExisting: CurrentUnitService,
        },
    ], ngImport: i0, template: "<cx-org-form [i18nRoot]=\"i18nRoot\">\n  <ng-container *ngIf=\"form\" [formGroup]=\"form\" main>\n    <label>\n      <span class=\"label-content required\">{{\n        'orgUnit.name' | cxTranslate\n      }}</span>\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        required\n        placeholder=\"{{ 'orgUnit.name' | cxTranslate }}\"\n        formControlName=\"name\"\n        (blur)=\"createUidWithName(form.get('name'), form.get('uid'))\"\n      />\n      <cx-form-errors [control]=\"form.get('name')\"></cx-form-errors>\n    </label>\n\n    <label>\n      <span class=\"label-content required\">{{\n        'orgUnit.uid' | cxTranslate\n      }}</span>\n      <input\n        class=\"form-control\"\n        type=\"text\"\n        required\n        placeholder=\"{{ 'orgUnit.uid' | cxTranslate }}\"\n        formControlName=\"uid\"\n      />\n      <cx-form-errors [control]=\"form.get('uid')\"></cx-form-errors>\n    </label>\n\n    <label formGroupName=\"approvalProcess\" class=\"full-width\">\n      <span class=\"label-content required\">{{\n        'orgUnit.approvalProcess' | cxTranslate\n      }}</span>\n      <ng-select\n        [inputAttrs]=\"{ required: 'true' }\"\n        formControlName=\"code\"\n        [searchable]=\"false\"\n        [items]=\"approvalProcess$ | async\"\n        bindLabel=\"name\"\n        bindValue=\"code\"\n        appendTo=\"cx-org-list\"\n        [placeholder]=\"'orgUnit.approvalProcess' | cxTranslate\"\n      >\n      </ng-select>\n      <cx-form-errors\n        [control]=\"form.get('approvalProcess.code')\"\n      ></cx-form-errors>\n    </label>\n    <ng-container *ngIf=\"form.get('parentOrgUnit'); else parentOrgUnitNotes\">\n      <label formGroupName=\"parentOrgUnit\">\n        <span class=\"label-content required\">{{\n          'orgUnit.form.parentOrgUnit' | cxTranslate\n        }}</span>\n        <ng-select\n          [inputAttrs]=\"{ required: 'true' }\"\n          formControlName=\"uid\"\n          [searchable]=\"true\"\n          [clearable]=\"false\"\n          [items]=\"(units$ | async) ?? null\"\n          bindLabel=\"name\"\n          bindValue=\"id\"\n          appendTo=\"cx-org-list\"\n          [placeholder]=\"'orgUnit.form.parentOrgUnit' | cxTranslate\"\n        >\n        </ng-select>\n        <cx-form-errors\n          [control]=\"form.get('parentOrgUnit.uid')\"\n        ></cx-form-errors>\n      </label>\n    </ng-container>\n    <ng-template #parentOrgUnitNotes>\n      <span class=\"notes-content\">{{\n        'orgUnit.form.parentOrgUnitNotes' | cxTranslate\n      }}</span>\n    </ng-template>\n  </ng-container>\n</cx-org-form>\n", dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.FormComponent, selector: "cx-org-form", inputs: ["i18nRoot", "animateBack", "subtitle"] }, { kind: "component", type: i5.NgSelectComponent, selector: "ng-select", inputs: ["bindLabel", "bindValue", "markFirst", "placeholder", "notFoundText", "typeToSearchText", "addTagText", "loadingText", "clearAllText", "appearance", "dropdownPosition", "appendTo", "loading", "closeOnSelect", "hideSelected", "selectOnTab", "openOnEnter", "maxSelectedItems", "groupBy", "groupValue", "bufferAmount", "virtualScroll", "selectableGroup", "selectableGroupAsModel", "searchFn", "trackByFn", "clearOnBackspace", "labelForId", "inputAttrs", "tabIndex", "readonly", "searchWhileComposing", "minTermLength", "editableSearchTerm", "keyDownFn", "typeahead", "multiple", "addTag", "searchable", "clearable", "isOpen", "items", "compareWith", "clearSearchOnAdd"], outputs: ["blur", "focus", "change", "open", "close", "search", "clear", "add", "remove", "scroll", "scrollToEnd"] }, { kind: "directive", type: i6.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i6.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i6.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i6.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "directive", type: i6.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i6.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "directive", type: i6.FormGroupName, selector: "[formGroupName]", inputs: ["formGroupName"] }, { kind: "component", type: i7.FormErrorsComponent, selector: "cx-form-errors", inputs: ["prefix", "translationParams", "control"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i8.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: UnitFormComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-org-unit-form', changeDetection: ChangeDetectionStrategy.OnPush, host: { class: 'content-wrapper' }, providers: [
                        {
                            provide: ItemService,
                            useExisting: UnitItemService,
                        },
                        {
                            provide: CurrentItemService,
                            useExisting: CurrentUnitService,
                        },
                    ], template: "<cx-org-form [i18nRoot]=\"i18nRoot\">\n  <ng-container *ngIf=\"form\" [formGroup]=\"form\" main>\n    <label>\n      <span class=\"label-content required\">{{\n        'orgUnit.name' | cxTranslate\n      }}</span>\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        required\n        placeholder=\"{{ 'orgUnit.name' | cxTranslate }}\"\n        formControlName=\"name\"\n        (blur)=\"createUidWithName(form.get('name'), form.get('uid'))\"\n      />\n      <cx-form-errors [control]=\"form.get('name')\"></cx-form-errors>\n    </label>\n\n    <label>\n      <span class=\"label-content required\">{{\n        'orgUnit.uid' | cxTranslate\n      }}</span>\n      <input\n        class=\"form-control\"\n        type=\"text\"\n        required\n        placeholder=\"{{ 'orgUnit.uid' | cxTranslate }}\"\n        formControlName=\"uid\"\n      />\n      <cx-form-errors [control]=\"form.get('uid')\"></cx-form-errors>\n    </label>\n\n    <label formGroupName=\"approvalProcess\" class=\"full-width\">\n      <span class=\"label-content required\">{{\n        'orgUnit.approvalProcess' | cxTranslate\n      }}</span>\n      <ng-select\n        [inputAttrs]=\"{ required: 'true' }\"\n        formControlName=\"code\"\n        [searchable]=\"false\"\n        [items]=\"approvalProcess$ | async\"\n        bindLabel=\"name\"\n        bindValue=\"code\"\n        appendTo=\"cx-org-list\"\n        [placeholder]=\"'orgUnit.approvalProcess' | cxTranslate\"\n      >\n      </ng-select>\n      <cx-form-errors\n        [control]=\"form.get('approvalProcess.code')\"\n      ></cx-form-errors>\n    </label>\n    <ng-container *ngIf=\"form.get('parentOrgUnit'); else parentOrgUnitNotes\">\n      <label formGroupName=\"parentOrgUnit\">\n        <span class=\"label-content required\">{{\n          'orgUnit.form.parentOrgUnit' | cxTranslate\n        }}</span>\n        <ng-select\n          [inputAttrs]=\"{ required: 'true' }\"\n          formControlName=\"uid\"\n          [searchable]=\"true\"\n          [clearable]=\"false\"\n          [items]=\"(units$ | async) ?? null\"\n          bindLabel=\"name\"\n          bindValue=\"id\"\n          appendTo=\"cx-org-list\"\n          [placeholder]=\"'orgUnit.form.parentOrgUnit' | cxTranslate\"\n        >\n        </ng-select>\n        <cx-form-errors\n          [control]=\"form.get('parentOrgUnit.uid')\"\n        ></cx-form-errors>\n      </label>\n    </ng-container>\n    <ng-template #parentOrgUnitNotes>\n      <span class=\"notes-content\">{{\n        'orgUnit.form.parentOrgUnitNotes' | cxTranslate\n      }}</span>\n    </ng-template>\n  </ng-container>\n</cx-org-form>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ItemService }, { type: i2.OrgUnitService }]; }, propDecorators: { i18nRoot: [{
                type: Input
            }], createChildUnit: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pdC1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29tcG9uZW50cy91bml0L2Zvcm0vdW5pdC1mb3JtLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29tcG9uZW50cy91bml0L2Zvcm0vdW5pdC1mb3JtLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxLQUFLLEdBRU4sTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUErQixjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQU05RSxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDdkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3hELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQzs7Ozs7Ozs7OztBQWtCaEUsTUFBTSxPQUFPLGlCQUFpQjtJQW1DNUIsWUFDWSxXQUFpQyxFQUNqQyxXQUEyQjtRQUQzQixnQkFBVyxHQUFYLFdBQVcsQ0FBc0I7UUFDakMsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBcEM5QixhQUFRLEdBQUcsU0FBUyxDQUFDO1FBRXJCLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBRWpDLFNBQUksR0FBNEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUUzRCxXQUFNLEdBQTBDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDekUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDWCxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwRCxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3hCLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLGVBQWUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDO2FBQzVDO1FBQ0gsQ0FBQyxDQUFDLEVBQ0YsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUNiLElBQUksQ0FBQyxXQUFXLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxJQUFJLENBQ3ZDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQ1osS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FDMUQsRUFDRCxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNaLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUMvQixJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7YUFDN0Q7UUFDSCxDQUFDLENBQUMsQ0FDSCxDQUNGLENBQ0YsQ0FBQztRQUVGLHFCQUFnQixHQUFxQyxJQUFJLENBQUMsV0FBVzthQUNsRSxvQkFBb0IsRUFBRTthQUN0QixJQUFJLENBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxFQUN0QixNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQ3BDLENBQUM7SUFLRCxDQUFDO0lBRUosUUFBUTtRQUNOLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVELGlCQUFpQixDQUNmLElBQTRCLEVBQzVCLElBQTRCO1FBRTVCLHVCQUF1QixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDOzs4R0FqRFUsaUJBQWlCO2tHQUFqQixpQkFBaUIsOEpBWGpCO1FBQ1Q7WUFDRSxPQUFPLEVBQUUsV0FBVztZQUNwQixXQUFXLEVBQUUsZUFBZTtTQUM3QjtRQUNEO1lBQ0UsT0FBTyxFQUFFLGtCQUFrQjtZQUMzQixXQUFXLEVBQUUsa0JBQWtCO1NBQ2hDO0tBQ0YsMEJDeENILHdsRkErRUE7MkZEckNhLGlCQUFpQjtrQkFoQjdCLFNBQVM7K0JBQ0Usa0JBQWtCLG1CQUVYLHVCQUF1QixDQUFDLE1BQU0sUUFDekMsRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsYUFDdkI7d0JBQ1Q7NEJBQ0UsT0FBTyxFQUFFLFdBQVc7NEJBQ3BCLFdBQVcsRUFBRSxlQUFlO3lCQUM3Qjt3QkFDRDs0QkFDRSxPQUFPLEVBQUUsa0JBQWtCOzRCQUMzQixXQUFXLEVBQUUsa0JBQWtCO3lCQUNoQztxQkFDRjsrSEFHUSxRQUFRO3NCQUFoQixLQUFLO2dCQUVHLGVBQWU7c0JBQXZCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgT25Jbml0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgVW50eXBlZEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEIyQkFwcHJvdmFsUHJvY2VzcywgQjJCVW5pdCwgaXNOb3RVbmRlZmluZWQgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHtcbiAgQjJCVW5pdE5vZGUsXG4gIE9yZ1VuaXRTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEN1cnJlbnRJdGVtU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9jdXJyZW50LWl0ZW0uc2VydmljZSc7XG5pbXBvcnQgeyBJdGVtU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9pdGVtLnNlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlQ29kZUZvckVudGl0eU5hbWUgfSBmcm9tICcuLi8uLi9zaGFyZWQvdXRpbGl0eS9lbnRpdHktY29kZSc7XG5pbXBvcnQgeyBDdXJyZW50VW5pdFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jdXJyZW50LXVuaXQuc2VydmljZSc7XG5pbXBvcnQgeyBVbml0SXRlbVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy91bml0LWl0ZW0uc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LW9yZy11bml0LWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJy4vdW5pdC1mb3JtLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGhvc3Q6IHsgY2xhc3M6ICdjb250ZW50LXdyYXBwZXInIH0sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IEl0ZW1TZXJ2aWNlLFxuICAgICAgdXNlRXhpc3Rpbmc6IFVuaXRJdGVtU2VydmljZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHByb3ZpZGU6IEN1cnJlbnRJdGVtU2VydmljZSxcbiAgICAgIHVzZUV4aXN0aW5nOiBDdXJyZW50VW5pdFNlcnZpY2UsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgVW5pdEZvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBpMThuUm9vdCA9ICdvcmdVbml0JztcblxuICBASW5wdXQoKSBjcmVhdGVDaGlsZFVuaXQgPSBmYWxzZTtcblxuICBmb3JtOiBVbnR5cGVkRm9ybUdyb3VwIHwgbnVsbCA9IHRoaXMuaXRlbVNlcnZpY2UuZ2V0Rm9ybSgpO1xuXG4gIHVuaXRzJDogT2JzZXJ2YWJsZTxCMkJVbml0Tm9kZVtdIHwgdW5kZWZpbmVkPiA9IHRoaXMuaXRlbVNlcnZpY2UudW5pdCQucGlwZShcbiAgICB0YXAoKHVuaXQpID0+IHtcbiAgICAgIHRoaXMuZm9ybT8uZ2V0KCdwYXJlbnRPcmdVbml0LnVpZCcpPy5zZXRWYWx1ZSh1bml0KTtcbiAgICAgIGlmICh0aGlzLmNyZWF0ZUNoaWxkVW5pdCkge1xuICAgICAgICB0aGlzLmZvcm0/LmdldCgncGFyZW50T3JnVW5pdCcpPy5kaXNhYmxlKCk7XG4gICAgICB9XG4gICAgfSksXG4gICAgc3dpdGNoTWFwKCgpID0+XG4gICAgICB0aGlzLnVuaXRTZXJ2aWNlLmdldEFjdGl2ZVVuaXRMaXN0KCkucGlwZShcbiAgICAgICAgbWFwKCh1bml0cykgPT5cbiAgICAgICAgICB1bml0cz8uZmlsdGVyKCh1bml0KSA9PiB1bml0LmlkICE9PSB0aGlzLmZvcm0/LnZhbHVlLnVpZClcbiAgICAgICAgKSxcbiAgICAgICAgdGFwKCh1bml0cykgPT4ge1xuICAgICAgICAgIGlmICh1bml0cyAmJiB1bml0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybT8uZ2V0KCdwYXJlbnRPcmdVbml0LnVpZCcpPy5zZXRWYWx1ZSh1bml0c1swXT8uaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgYXBwcm92YWxQcm9jZXNzJDogT2JzZXJ2YWJsZTxCMkJBcHByb3ZhbFByb2Nlc3NbXT4gPSB0aGlzLnVuaXRTZXJ2aWNlXG4gICAgLmdldEFwcHJvdmFsUHJvY2Vzc2VzKClcbiAgICAucGlwZShcbiAgICAgIGZpbHRlcihpc05vdFVuZGVmaW5lZCksXG4gICAgICBmaWx0ZXIoKGl0ZW1zKSA9PiBpdGVtcy5sZW5ndGggPiAwKVxuICAgICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGl0ZW1TZXJ2aWNlOiBJdGVtU2VydmljZTxCMkJVbml0PixcbiAgICBwcm90ZWN0ZWQgdW5pdFNlcnZpY2U6IE9yZ1VuaXRTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnVuaXRTZXJ2aWNlLmxvYWRMaXN0KCk7XG4gIH1cblxuICBjcmVhdGVVaWRXaXRoTmFtZShcbiAgICBuYW1lOiBBYnN0cmFjdENvbnRyb2wgfCBudWxsLFxuICAgIGNvZGU6IEFic3RyYWN0Q29udHJvbCB8IG51bGxcbiAgKTogdm9pZCB7XG4gICAgY3JlYXRlQ29kZUZvckVudGl0eU5hbWUobmFtZSwgY29kZSk7XG4gIH1cbn1cbiIsIjxjeC1vcmctZm9ybSBbaTE4blJvb3RdPVwiaTE4blJvb3RcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImZvcm1cIiBbZm9ybUdyb3VwXT1cImZvcm1cIiBtYWluPlxuICAgIDxsYWJlbD5cbiAgICAgIDxzcGFuIGNsYXNzPVwibGFiZWwtY29udGVudCByZXF1aXJlZFwiPnt7XG4gICAgICAgICdvcmdVbml0Lm5hbWUnIHwgY3hUcmFuc2xhdGVcbiAgICAgIH19PC9zcGFuPlxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICByZXF1aXJlZFxuICAgICAgICBwbGFjZWhvbGRlcj1cInt7ICdvcmdVbml0Lm5hbWUnIHwgY3hUcmFuc2xhdGUgfX1cIlxuICAgICAgICBmb3JtQ29udHJvbE5hbWU9XCJuYW1lXCJcbiAgICAgICAgKGJsdXIpPVwiY3JlYXRlVWlkV2l0aE5hbWUoZm9ybS5nZXQoJ25hbWUnKSwgZm9ybS5nZXQoJ3VpZCcpKVwiXG4gICAgICAvPlxuICAgICAgPGN4LWZvcm0tZXJyb3JzIFtjb250cm9sXT1cImZvcm0uZ2V0KCduYW1lJylcIj48L2N4LWZvcm0tZXJyb3JzPlxuICAgIDwvbGFiZWw+XG5cbiAgICA8bGFiZWw+XG4gICAgICA8c3BhbiBjbGFzcz1cImxhYmVsLWNvbnRlbnQgcmVxdWlyZWRcIj57e1xuICAgICAgICAnb3JnVW5pdC51aWQnIHwgY3hUcmFuc2xhdGVcbiAgICAgIH19PC9zcGFuPlxuICAgICAgPGlucHV0XG4gICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICByZXF1aXJlZFxuICAgICAgICBwbGFjZWhvbGRlcj1cInt7ICdvcmdVbml0LnVpZCcgfCBjeFRyYW5zbGF0ZSB9fVwiXG4gICAgICAgIGZvcm1Db250cm9sTmFtZT1cInVpZFwiXG4gICAgICAvPlxuICAgICAgPGN4LWZvcm0tZXJyb3JzIFtjb250cm9sXT1cImZvcm0uZ2V0KCd1aWQnKVwiPjwvY3gtZm9ybS1lcnJvcnM+XG4gICAgPC9sYWJlbD5cblxuICAgIDxsYWJlbCBmb3JtR3JvdXBOYW1lPVwiYXBwcm92YWxQcm9jZXNzXCIgY2xhc3M9XCJmdWxsLXdpZHRoXCI+XG4gICAgICA8c3BhbiBjbGFzcz1cImxhYmVsLWNvbnRlbnQgcmVxdWlyZWRcIj57e1xuICAgICAgICAnb3JnVW5pdC5hcHByb3ZhbFByb2Nlc3MnIHwgY3hUcmFuc2xhdGVcbiAgICAgIH19PC9zcGFuPlxuICAgICAgPG5nLXNlbGVjdFxuICAgICAgICBbaW5wdXRBdHRyc109XCJ7IHJlcXVpcmVkOiAndHJ1ZScgfVwiXG4gICAgICAgIGZvcm1Db250cm9sTmFtZT1cImNvZGVcIlxuICAgICAgICBbc2VhcmNoYWJsZV09XCJmYWxzZVwiXG4gICAgICAgIFtpdGVtc109XCJhcHByb3ZhbFByb2Nlc3MkIHwgYXN5bmNcIlxuICAgICAgICBiaW5kTGFiZWw9XCJuYW1lXCJcbiAgICAgICAgYmluZFZhbHVlPVwiY29kZVwiXG4gICAgICAgIGFwcGVuZFRvPVwiY3gtb3JnLWxpc3RcIlxuICAgICAgICBbcGxhY2Vob2xkZXJdPVwiJ29yZ1VuaXQuYXBwcm92YWxQcm9jZXNzJyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgID5cbiAgICAgIDwvbmctc2VsZWN0PlxuICAgICAgPGN4LWZvcm0tZXJyb3JzXG4gICAgICAgIFtjb250cm9sXT1cImZvcm0uZ2V0KCdhcHByb3ZhbFByb2Nlc3MuY29kZScpXCJcbiAgICAgID48L2N4LWZvcm0tZXJyb3JzPlxuICAgIDwvbGFiZWw+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImZvcm0uZ2V0KCdwYXJlbnRPcmdVbml0Jyk7IGVsc2UgcGFyZW50T3JnVW5pdE5vdGVzXCI+XG4gICAgICA8bGFiZWwgZm9ybUdyb3VwTmFtZT1cInBhcmVudE9yZ1VuaXRcIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbC1jb250ZW50IHJlcXVpcmVkXCI+e3tcbiAgICAgICAgICAnb3JnVW5pdC5mb3JtLnBhcmVudE9yZ1VuaXQnIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgfX08L3NwYW4+XG4gICAgICAgIDxuZy1zZWxlY3RcbiAgICAgICAgICBbaW5wdXRBdHRyc109XCJ7IHJlcXVpcmVkOiAndHJ1ZScgfVwiXG4gICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwidWlkXCJcbiAgICAgICAgICBbc2VhcmNoYWJsZV09XCJ0cnVlXCJcbiAgICAgICAgICBbY2xlYXJhYmxlXT1cImZhbHNlXCJcbiAgICAgICAgICBbaXRlbXNdPVwiKHVuaXRzJCB8IGFzeW5jKSA/PyBudWxsXCJcbiAgICAgICAgICBiaW5kTGFiZWw9XCJuYW1lXCJcbiAgICAgICAgICBiaW5kVmFsdWU9XCJpZFwiXG4gICAgICAgICAgYXBwZW5kVG89XCJjeC1vcmctbGlzdFwiXG4gICAgICAgICAgW3BsYWNlaG9sZGVyXT1cIidvcmdVbml0LmZvcm0ucGFyZW50T3JnVW5pdCcgfCBjeFRyYW5zbGF0ZVwiXG4gICAgICAgID5cbiAgICAgICAgPC9uZy1zZWxlY3Q+XG4gICAgICAgIDxjeC1mb3JtLWVycm9yc1xuICAgICAgICAgIFtjb250cm9sXT1cImZvcm0uZ2V0KCdwYXJlbnRPcmdVbml0LnVpZCcpXCJcbiAgICAgICAgPjwvY3gtZm9ybS1lcnJvcnM+XG4gICAgICA8L2xhYmVsPlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDxuZy10ZW1wbGF0ZSAjcGFyZW50T3JnVW5pdE5vdGVzPlxuICAgICAgPHNwYW4gY2xhc3M9XCJub3Rlcy1jb250ZW50XCI+e3tcbiAgICAgICAgJ29yZ1VuaXQuZm9ybS5wYXJlbnRPcmdVbml0Tm90ZXMnIHwgY3hUcmFuc2xhdGVcbiAgICAgIH19PC9zcGFuPlxuICAgIDwvbmctdGVtcGxhdGU+XG4gIDwvbmctY29udGFpbmVyPlxuPC9jeC1vcmctZm9ybT5cbiJdfQ==