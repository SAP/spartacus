{"version":3,"file":"spartacus-asm-occ.mjs","sources":["../../../feature-libs/asm/occ/adapters/occ-asm.adapter.ts","../../../feature-libs/asm/occ/adapters/index.ts","../../../feature-libs/asm/occ/adapters/default-occ-asm-config.ts","../../../feature-libs/asm/occ/asm-occ.module.ts","../../../feature-libs/asm/occ/model/occ-asm-endpoints.model.ts","../../../feature-libs/asm/occ/model/index.ts","../../../feature-libs/asm/occ/public_api.ts","../../../feature-libs/asm/occ/spartacus-asm-occ.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\nimport { Injectable, inject } from '@angular/core';\nimport {\n  AsmAdapter,\n  CUSTOMER_LISTS_NORMALIZER,\n  CUSTOMER_SEARCH_PAGE_NORMALIZER,\n} from '@spartacus/asm/core';\nimport {\n  AsmConfig,\n  BindCartParams,\n  CustomerListsPage,\n  CustomerRegistrationForm,\n  CustomerSearchOptions,\n  CustomerSearchPage,\n} from '@spartacus/asm/root';\nimport {\n  BaseSiteService,\n  ConverterService,\n  InterceptorUtil,\n  LoggerService,\n  OccEndpointsService,\n  USE_CUSTOMER_SUPPORT_AGENT_TOKEN,\n  User,\n  normalizeHttpError,\n} from '@spartacus/core';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\n@Injectable()\nexport class OccAsmAdapter implements AsmAdapter {\n  private activeBaseSite: string;\n\n  protected logger = inject(LoggerService);\n\n  constructor(\n    protected http: HttpClient,\n    protected occEndpointsService: OccEndpointsService,\n    protected converterService: ConverterService,\n    protected config: AsmConfig,\n    protected baseSiteService: BaseSiteService\n  ) {\n    this.baseSiteService\n      .getActive()\n      .subscribe((value) => (this.activeBaseSite = value));\n  }\n\n  protected getHeaders(): HttpHeaders {\n    return InterceptorUtil.createHeader(\n      USE_CUSTOMER_SUPPORT_AGENT_TOKEN,\n      true,\n      new HttpHeaders()\n    );\n  }\n\n  customerLists(): Observable<CustomerListsPage> {\n    const headers = this.getHeaders();\n    const params: HttpParams = new HttpParams().set(\n      'baseSite',\n      this.activeBaseSite\n    );\n\n    const url = this.occEndpointsService.buildUrl(\n      'asmCustomerLists',\n      {},\n      {\n        baseSite: false,\n        prefix: false,\n      }\n    );\n\n    return this.http.get<CustomerListsPage>(url, { headers, params }).pipe(\n      catchError((error) => throwError(normalizeHttpError(error, this.logger))),\n      this.converterService.pipeable(CUSTOMER_LISTS_NORMALIZER)\n    );\n  }\n\n  customerSearch(\n    options: CustomerSearchOptions\n  ): Observable<CustomerSearchPage> {\n    const headers = this.getHeaders();\n    let params: HttpParams = new HttpParams().set(\n      'baseSite',\n      this.activeBaseSite\n    );\n\n    if (options.sort !== undefined) {\n      params = params.set('sort', options.sort);\n    } else {\n      if (!options.customerListId) {\n        params = params.set('sort', 'byNameAsc');\n      }\n    }\n\n    if (options.query !== undefined) {\n      params = params.set('query', options.query);\n    }\n\n    if (options.pageSize !== undefined) {\n      params = params.set('pageSize', options.pageSize.toString());\n    }\n\n    if (options.currentPage !== undefined) {\n      params = params.set('currentPage', options.currentPage.toString());\n    }\n\n    if (options.customerListId !== undefined) {\n      params = params.set('customerListId', options.customerListId);\n    }\n\n    const url = this.occEndpointsService.buildUrl(\n      'asmCustomerSearch',\n      {},\n      {\n        baseSite: false,\n        prefix: false,\n      }\n    );\n\n    return this.http.get<CustomerSearchPage>(url, { headers, params }).pipe(\n      catchError((error) => throwError(normalizeHttpError(error, this.logger))),\n      this.converterService.pipeable(CUSTOMER_SEARCH_PAGE_NORMALIZER)\n    );\n  }\n\n  bindCart({ cartId, customerId }: BindCartParams): Observable<unknown> {\n    const headers = InterceptorUtil.createHeader(\n      USE_CUSTOMER_SUPPORT_AGENT_TOKEN,\n      true,\n      new HttpHeaders()\n    );\n    const params: HttpParams = new HttpParams()\n      .set('baseSite', this.activeBaseSite)\n      .set('cartId', cartId)\n      .set('customerId', customerId);\n\n    const url = this.occEndpointsService.buildUrl(\n      'asmBindCart',\n      {},\n      {\n        baseSite: false,\n        prefix: false,\n      }\n    );\n\n    return this.http\n      .post<void>(url, {}, { headers, params })\n      .pipe(\n        catchError((error) =>\n          throwError(normalizeHttpError(error, this.logger))\n        )\n      );\n  }\n\n  createCustomer(user: CustomerRegistrationForm): Observable<User> {\n    const headers = this.getHeaders();\n    const params: HttpParams = new HttpParams().set(\n      'baseSite',\n      this.activeBaseSite\n    );\n\n    const url = this.occEndpointsService.buildUrl(\n      'asmCreateCustomer',\n      {},\n      {\n        baseSite: false,\n        prefix: false,\n      }\n    );\n    return this.http\n      .post<User>(url, user, { headers, params })\n      .pipe(\n        catchError((error) =>\n          throwError(normalizeHttpError(error, this.logger))\n        )\n      );\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './occ-asm.adapter';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { OccConfig } from '@spartacus/core';\n\nexport const defaultOccAsmConfig: OccConfig = {\n  backend: {\n    occ: {\n      endpoints: {\n        asmCustomerSearch: '/assistedservicewebservices/customers/search',\n        asmCustomerLists: '/assistedservicewebservices/customerlists',\n        asmBindCart: '/assistedservicewebservices/bind-cart',\n        asmCreateCustomer: '/assistedservicewebservices/customers',\n      },\n    },\n  },\n};\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { AsmAdapter } from '@spartacus/asm/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { defaultOccAsmConfig } from './adapters/default-occ-asm-config';\nimport { OccAsmAdapter } from './adapters/occ-asm.adapter';\n\n@NgModule({\n  imports: [CommonModule],\n  providers: [\n    provideDefaultConfig(defaultOccAsmConfig),\n    {\n      provide: AsmAdapter,\n      useClass: OccAsmAdapter,\n    },\n  ],\n})\nexport class AsmOccModule {}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { OccEndpoint } from '@spartacus/core';\n\ndeclare module '@spartacus/core' {\n  interface OccEndpoints {\n    /**\n     * Endpoint for asm customer search\n     *\n     * @member {string}\n     */\n    asmCustomerSearch?: string | OccEndpoint;\n    asmCustomerLists?: string | OccEndpoint;\n    asmBindCart?: string | OccEndpoint;\n    asmCreateCustomer?: string | OccEndpoint;\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './occ-asm-endpoints.model';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './adapters/index';\nexport * from './asm-occ.module';\nexport * from './model/index';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;AAIG;MA+BU,aAAa,CAAA;IAKxB,WACY,CAAA,IAAgB,EAChB,mBAAwC,EACxC,gBAAkC,EAClC,MAAiB,EACjB,eAAgC,EAAA;QAJhC,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAY;QAChB,IAAmB,CAAA,mBAAA,GAAnB,mBAAmB,CAAqB;QACxC,IAAgB,CAAA,gBAAA,GAAhB,gBAAgB,CAAkB;QAClC,IAAM,CAAA,MAAA,GAAN,MAAM,CAAW;QACjB,IAAe,CAAA,eAAA,GAAf,eAAe,CAAiB;AAPlC,QAAA,IAAA,CAAA,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC,CAAC;AASvC,QAAA,IAAI,CAAC,eAAe;AACjB,aAAA,SAAS,EAAE;AACX,aAAA,SAAS,CAAC,CAAC,KAAK,MAAM,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC,CAAC,CAAC;KACxD;IAES,UAAU,GAAA;AAClB,QAAA,OAAO,eAAe,CAAC,YAAY,CACjC,gCAAgC,EAChC,IAAI,EACJ,IAAI,WAAW,EAAE,CAClB,CAAC;KACH;IAED,aAAa,GAAA;AACX,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;AAClC,QAAA,MAAM,MAAM,GAAe,IAAI,UAAU,EAAE,CAAC,GAAG,CAC7C,UAAU,EACV,IAAI,CAAC,cAAc,CACpB,CAAC;QAEF,MAAM,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAC3C,kBAAkB,EAClB,EAAE,EACF;AACE,YAAA,QAAQ,EAAE,KAAK;AACf,YAAA,MAAM,EAAE,KAAK;AACd,SAAA,CACF,CAAC;QAEF,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAoB,GAAG,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,IAAI,CACpE,UAAU,CAAC,CAAC,KAAK,KAAK,UAAU,CAAC,kBAAkB,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EACzE,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,yBAAyB,CAAC,CAC1D,CAAC;KACH;AAED,IAAA,cAAc,CACZ,OAA8B,EAAA;AAE9B,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;AAClC,QAAA,IAAI,MAAM,GAAe,IAAI,UAAU,EAAE,CAAC,GAAG,CAC3C,UAAU,EACV,IAAI,CAAC,cAAc,CACpB,CAAC;AAEF,QAAA,IAAI,OAAO,CAAC,IAAI,KAAK,SAAS,EAAE;YAC9B,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;AAC3C,SAAA;AAAM,aAAA;AACL,YAAA,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE;gBAC3B,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;AAC1C,aAAA;AACF,SAAA;AAED,QAAA,IAAI,OAAO,CAAC,KAAK,KAAK,SAAS,EAAE;YAC/B,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;AAC7C,SAAA;AAED,QAAA,IAAI,OAAO,CAAC,QAAQ,KAAK,SAAS,EAAE;AAClC,YAAA,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,UAAU,EAAE,OAAO,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC;AAC9D,SAAA;AAED,QAAA,IAAI,OAAO,CAAC,WAAW,KAAK,SAAS,EAAE;AACrC,YAAA,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC,CAAC;AACpE,SAAA;AAED,QAAA,IAAI,OAAO,CAAC,cAAc,KAAK,SAAS,EAAE;YACxC,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,gBAAgB,EAAE,OAAO,CAAC,cAAc,CAAC,CAAC;AAC/D,SAAA;QAED,MAAM,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAC3C,mBAAmB,EACnB,EAAE,EACF;AACE,YAAA,QAAQ,EAAE,KAAK;AACf,YAAA,MAAM,EAAE,KAAK;AACd,SAAA,CACF,CAAC;QAEF,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAqB,GAAG,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,IAAI,CACrE,UAAU,CAAC,CAAC,KAAK,KAAK,UAAU,CAAC,kBAAkB,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EACzE,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,+BAA+B,CAAC,CAChE,CAAC;KACH;AAED,IAAA,QAAQ,CAAC,EAAE,MAAM,EAAE,UAAU,EAAkB,EAAA;AAC7C,QAAA,MAAM,OAAO,GAAG,eAAe,CAAC,YAAY,CAC1C,gCAAgC,EAChC,IAAI,EACJ,IAAI,WAAW,EAAE,CAClB,CAAC;AACF,QAAA,MAAM,MAAM,GAAe,IAAI,UAAU,EAAE;AACxC,aAAA,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,cAAc,CAAC;AACpC,aAAA,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC;AACrB,aAAA,GAAG,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;QAEjC,MAAM,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAC3C,aAAa,EACb,EAAE,EACF;AACE,YAAA,QAAQ,EAAE,KAAK;AACf,YAAA,MAAM,EAAE,KAAK;AACd,SAAA,CACF,CAAC;QAEF,OAAO,IAAI,CAAC,IAAI;aACb,IAAI,CAAO,GAAG,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC;aACxC,IAAI,CACH,UAAU,CAAC,CAAC,KAAK,KACf,UAAU,CAAC,kBAAkB,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CACnD,CACF,CAAC;KACL;AAED,IAAA,cAAc,CAAC,IAA8B,EAAA;AAC3C,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;AAClC,QAAA,MAAM,MAAM,GAAe,IAAI,UAAU,EAAE,CAAC,GAAG,CAC7C,UAAU,EACV,IAAI,CAAC,cAAc,CACpB,CAAC;QAEF,MAAM,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAC3C,mBAAmB,EACnB,EAAE,EACF;AACE,YAAA,QAAQ,EAAE,KAAK;AACf,YAAA,MAAM,EAAE,KAAK;AACd,SAAA,CACF,CAAC;QACF,OAAO,IAAI,CAAC,IAAI;aACb,IAAI,CAAO,GAAG,EAAE,IAAI,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC;aAC1C,IAAI,CACH,UAAU,CAAC,CAAC,KAAK,KACf,UAAU,CAAC,kBAAkB,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CACnD,CACF,CAAC;KACL;;0GAlJU,aAAa,EAAA,IAAA,EAAA,CAAA,EAAA,KAAA,EAAA,EAAA,CAAA,UAAA,EAAA,EAAA,EAAA,KAAA,EAAA,EAAA,CAAA,mBAAA,EAAA,EAAA,EAAA,KAAA,EAAA,EAAA,CAAA,gBAAA,EAAA,EAAA,EAAA,KAAA,EAAA,EAAA,CAAA,SAAA,EAAA,EAAA,EAAA,KAAA,EAAA,EAAA,CAAA,eAAA,EAAA,CAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;8GAAb,aAAa,EAAA,CAAA,CAAA;2FAAb,aAAa,EAAA,UAAA,EAAA,CAAA;kBADzB,UAAU;;;AClCX;;;;AAIG;;ACJH;;;;AAIG;AAII,MAAM,mBAAmB,GAAc;AAC5C,IAAA,OAAO,EAAE;AACP,QAAA,GAAG,EAAE;AACH,YAAA,SAAS,EAAE;AACT,gBAAA,iBAAiB,EAAE,8CAA8C;AACjE,gBAAA,gBAAgB,EAAE,2CAA2C;AAC7D,gBAAA,WAAW,EAAE,uCAAuC;AACpD,gBAAA,iBAAiB,EAAE,uCAAuC;AAC3D,aAAA;AACF,SAAA;AACF,KAAA;CACF;;ACnBD;;;;AAIG;MAmBU,YAAY,CAAA;;yGAAZ,YAAY,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,QAAA,EAAA,CAAA,CAAA;AAAZ,YAAA,CAAA,IAAA,GAAA,EAAA,CAAA,mBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,YAAY,YATb,YAAY,CAAA,EAAA,CAAA,CAAA;AASX,YAAA,CAAA,IAAA,GAAA,EAAA,CAAA,mBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,YAAY,EARZ,SAAA,EAAA;QACT,oBAAoB,CAAC,mBAAmB,CAAC;AACzC,QAAA;AACE,YAAA,OAAO,EAAE,UAAU;AACnB,YAAA,QAAQ,EAAE,aAAa;AACxB,SAAA;AACF,KAAA,EAAA,OAAA,EAAA,CAPS,YAAY,CAAA,EAAA,CAAA,CAAA;2FASX,YAAY,EAAA,UAAA,EAAA,CAAA;kBAVxB,QAAQ;AAAC,YAAA,IAAA,EAAA,CAAA;oBACR,OAAO,EAAE,CAAC,YAAY,CAAC;AACvB,oBAAA,SAAS,EAAE;wBACT,oBAAoB,CAAC,mBAAmB,CAAC;AACzC,wBAAA;AACE,4BAAA,OAAO,EAAE,UAAU;AACnB,4BAAA,QAAQ,EAAE,aAAa;AACxB,yBAAA;AACF,qBAAA;AACF,iBAAA,CAAA;;;ACtBD;;;;AAIG;;ACJH;;;;AAIG;;ACJH;;;;AAIG;;ACJH;;AAEG;;;;"}