<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>storefrontapp documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">storefrontapp documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>LibraryWithSpartacusDeps</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>tools/config/tsconfig-paths.ts</code>
        </p>


            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                        <code><a href="../miscellaneous/typealiases.html#Library" target="_self" >Library</a></code>
            </p>

        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#spartacusDependencies">spartacusDependencies</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="spartacusDependencies"></a>
                                        <span class="name"><b>spartacusDependencies</b><a href="#spartacusDependencies"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>spartacusDependencies:     <code>string[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string[]</code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>All spartacus packages that this library depend on.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import chalk from &#x27;chalk&#x27;;
import { assign, parse, stringify } from &#x27;comment-json&#x27;;
import fs from &#x27;fs&#x27;;
import glob from &#x27;glob&#x27;;
import path from &#x27;path&#x27;;
import { SPARTACUS_SCHEMATICS, SPARTACUS_SCOPE } from &#x27;./const&#x27;;
import {
  error,
  Library,
  logUpdatedFile,
  ProgramOptions,
  reportProgress,
  Repository,
  success,
} from &#x27;./index&#x27;;

function readTsConfigFile(path: string): any {
  return parse(fs.readFileSync(path, &#x27;utf-8&#x27;));
}

function setCompilerOptionsPaths(tsconfigPath: string, paths: Object) {
  const tsConfigContent &#x3D; readTsConfigFile(tsconfigPath);
  assign(tsConfigContent.compilerOptions, { paths });
  fs.writeFileSync(tsconfigPath, stringify(tsConfigContent, null, 2));
}

function joinPaths(...parts: string[]) {
  return path.join(...parts).replace(/\\/g, &#x27;/&#x27;);
}

interface LibraryWithSpartacusDeps extends Library {
  /**
   * All spartacus packages that this library depend on.
   */
  spartacusDependencies: string[];
}

/**
 * Checks and updates tsconfig files across repository.
 */
export function manageTsConfigs(
  repository: Repository,
  options: ProgramOptions
) {
  const libraries: Record&lt;string, LibraryWithSpartacusDeps&gt; &#x3D; Object.values(
    repository
  )
    .map((lib) &#x3D;&gt; {
      return {
        ...lib,
        spartacusDependencies: Object.keys(
          lib.peerDependencies ?? {}
        ).filter((dep) &#x3D;&gt; dep.startsWith(&#x60;${SPARTACUS_SCOPE}/&#x60;)),
      };
    })
    .reduce((acc: Record&lt;string, LibraryWithSpartacusDeps&gt;, lib) &#x3D;&gt; {
      acc[lib.name] &#x3D; lib;
      return acc;
    }, {});

  handleSchematicsConfigs(libraries, options);
  handleLibConfigs(libraries, options);
  handleRootConfigs(libraries, options);
  handleAppConfigs(libraries, options);
}

/**
 * Compare target paths with current paths and reports extra or missing entries.
 *
 * @param targetPaths paths that should be in the file
 * @param tsConfigPath path to targeted config
 * @param silent set to tru if you don&#x27;t want to output errors (eg. in fix mode)
 *
 * @returns true when there were some errors
 */
function comparePathsConfigs(
  targetPaths: Record&lt;string, string[]&gt;,
  tsConfigPath: string,
  silent &#x3D; false
): boolean {
  const tsConfig &#x3D; readTsConfigFile(tsConfigPath);
  const currentPaths: Record&lt;string, string[]&gt; &#x3D;
    tsConfig?.compilerOptions?.paths ?? {};
  const errors &#x3D; [];
  Object.keys(currentPaths).forEach((key) &#x3D;&gt; {
    if (typeof targetPaths[key] &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
      errors.push(
        &#x60;Key ${chalk.bold(key)} should not be present in ${chalk.bold(
          &#x60;compilerOptions.paths&#x60;
        )}.&#x60;
      );
    }
  });
  Object.entries(targetPaths).forEach(([key, value]) &#x3D;&gt; {
    if (typeof currentPaths[key] &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
      errors.push(
        &#x60;Property ${chalk.bold(
          &#x60;&quot;${key}&quot;: [&quot;${value[0]}&quot;]&#x60;
        )} is missing in ${chalk.bold(&#x27;compilerOptions.paths&#x27;)}.&#x60;
      );
    } else if (value[0] !&#x3D;&#x3D; currentPaths[key][0]) {
      errors.push(
        &#x60;Key ${chalk.bold(key)} should have value ${chalk.bold(
          &#x60;[${value[0]}]&#x60;
        )} in ${chalk.bold(&#x27;compilerOptions.paths&#x27;)}.&#x60;
      );
    }
  });
  if (!silent &amp;&amp; errors.length &gt; 0) {
    error(tsConfigPath, errors, [
      &#x60;This can be automatically fixed by running \&#x60;${chalk.bold(
        &#x60;yarn config:update&#x60;
      )}\&#x60;.&#x60;,
    ]);
  }
  return errors.length &gt; 0;
}

/**
 * Compares paths and reports errors or updates configs.
 *
 * @returns true when there were some errors
 */
function handleConfigUpdate(
  targetPaths: any,
  file: string,
  options: ProgramOptions
): boolean {
  const errorsPresent &#x3D; comparePathsConfigs(targetPaths, file, options.fix);
  if (errorsPresent &amp;&amp; options.fix) {
    setCompilerOptionsPaths(file, targetPaths);
    logUpdatedFile(file);
  }
  return errorsPresent;
}

/**
 * When library have its own schematics ts config (tsconfig.schematics.json exists) and have
 * schematics as peerDependency we add path to &#x60;@spartacus/schematics&#x60; lib.
 */
function handleSchematicsConfigs(
  libraries: Record&lt;string, LibraryWithSpartacusDeps&gt;,
  options: ProgramOptions
): void {
  const targetPaths &#x3D; {
    [SPARTACUS_SCHEMATICS]: [&#x27;../../projects/schematics/src/public_api&#x27;],
  };
  if (options.fix) {
    reportProgress(&#x27;Updating tsconfig.schematics.json files&#x27;);
  } else {
    reportProgress(&#x27;Checking tsconfig.schematics.json files&#x27;);
  }
  let showAllGood &#x3D; true;
  Object.values(libraries).forEach((library) &#x3D;&gt; {
    const schematicsTsConfigPaths &#x3D; glob.sync(
      &#x60;${library.directory}/tsconfig.schematics.json&#x60;
    );
    if (
      schematicsTsConfigPaths.length &amp;&amp;
      library.spartacusDependencies.includes(SPARTACUS_SCHEMATICS)
    ) {
      const hadErrors &#x3D; handleConfigUpdate(
        targetPaths,
        schematicsTsConfigPaths[0],
        options
      );
      if (hadErrors) {
        showAllGood &#x3D; false;
      }
    }
  });
  if (showAllGood) {
    success();
  }
}

/**
 * Adds paths to spartacus dependencies in &#x60;tsconfig.lib.json&#x60; files.
 * We grab all spartacus dependencies and add for all of them all entry points.
 */
function handleLibConfigs(
  libraries: Record&lt;string, LibraryWithSpartacusDeps&gt;,
  options: ProgramOptions
): void {
  if (options.fix) {
    reportProgress(&#x27;Updating tsconfig.lib.json files&#x27;);
  } else {
    reportProgress(&#x27;Checking tsconfig.lib.json files&#x27;);
  }
  let showAllGood &#x3D; true;
  Object.values(libraries).forEach((library) &#x3D;&gt; {
    const libraryTsConfigPaths &#x3D; glob.sync(
      &#x60;${library.directory}/tsconfig.lib.json&#x60;
    );
    if (libraryTsConfigPaths.length) {
      let dependenciesEntryPoints &#x3D; library.spartacusDependencies
        // @spartacus/schematics library should be used only in &#x60;tsconfig.schematics.json&#x60; file.
        .filter((dependency) &#x3D;&gt; dependency !&#x3D;&#x3D; SPARTACUS_SCHEMATICS)
        .map((library) &#x3D;&gt; libraries[library])
        .reduce((entryPoints, dependency) &#x3D;&gt; {
          let dependencyEntryPoints &#x3D; dependency.entryPoints.reduce(
            (acc, entry) &#x3D;&gt; {
              return {
                ...acc,
                // In tsconfig.lib.json files we reference built paths. eg. &#x60;@spartacus/storefront&#x60;: [&#x27;dist/storefrontlib/src/public_api&#x27;]
                [entry.entryPoint]: [
                  joinPaths(&#x27;dist&#x27;, dependency.distDir, entry.directory),
                ],
              };
            },
            {}
          );
          return { ...entryPoints, ...dependencyEntryPoints };
        }, {});
      const hadErrors &#x3D; handleConfigUpdate(
        dependenciesEntryPoints,
        libraryTsConfigPaths[0],
        options
      );
      if (hadErrors) {
        showAllGood &#x3D; false;
      }
    }
  });
  if (showAllGood) {
    success();
  }
}

/**
 * Add paths to all libraries and all their entry points to root &#x60;tsconfig.json&#x60; and &#x60;tsconfig.compodoc.json&#x60; files.
 */
function handleRootConfigs(
  libraries: Record&lt;string, LibraryWithSpartacusDeps&gt;,
  options: ProgramOptions
): void {
  if (options.fix) {
    reportProgress(&#x27;Updating root tsconfig files&#x27;);
  } else {
    reportProgress(&#x27;Checking root tsconfig files&#x27;);
  }
  let showAllGood &#x3D; true;
  const entryPoints &#x3D; Object.values(libraries).reduce((acc, curr) &#x3D;&gt; {
    curr.entryPoints.forEach((entryPoint) &#x3D;&gt; {
      acc[entryPoint.entryPoint] &#x3D; [
        // We reference source files entry points in these configs. E.g. &#x60;projects/storefrontlib/src/public_api&#x60;
        joinPaths(curr.directory, entryPoint.directory, entryPoint.entryFile),
      ];
    });
    return acc;
  }, {});

  const hadErrors &#x3D; handleConfigUpdate(entryPoints, &#x27;tsconfig.json&#x27;, options);
  const hadErrorsCompodoc &#x3D; handleConfigUpdate(
    entryPoints,
    &#x27;tsconfig.compodoc.json&#x27;,
    options
  );
  if (hadErrors || hadErrorsCompodoc) {
    showAllGood &#x3D; false;
  }
  if (showAllGood) {
    success();
  }
}

function handleAppConfigs(
  libraries: Record&lt;string, LibraryWithSpartacusDeps&gt;,
  options: ProgramOptions
): void {
  if (options.fix) {
    reportProgress(&#x27;Updating app tsconfig files&#x27;);
  } else {
    reportProgress(&#x27;Checking app tsconfig files&#x27;);
  }
  let showAllGood &#x3D; true;
  // Add paths to &#x60;projects/storefrontapp/tsconfig.app.prod.json&#x60; config.
  const appEntryPoints &#x3D; Object.values(libraries)
    .filter((lib) &#x3D;&gt; lib.name !&#x3D;&#x3D; SPARTACUS_SCHEMATICS)
    .reduce((acc, curr) &#x3D;&gt; {
      curr.entryPoints.forEach((entryPoint) &#x3D;&gt; {
        acc[entryPoint.entryPoint] &#x3D; [
          joinPaths(&#x27;dist&#x27;, curr.distDir, entryPoint.directory),
        ];
      });
      return acc;
    }, {});

  const hadErrorsApp &#x3D; handleConfigUpdate(
    appEntryPoints,
    &#x27;projects/storefrontapp/tsconfig.app.prod.json&#x27;,
    options
  );

  // Add paths to &#x60;projects/storefrontapp/tsconfig.server.json&#x60; config.
  const serverEntryPoints &#x3D; Object.values(libraries)
    .filter((lib) &#x3D;&gt; lib.name !&#x3D;&#x3D; SPARTACUS_SCHEMATICS)
    .reduce((acc, curr) &#x3D;&gt; {
      curr.entryPoints.forEach((entryPoint) &#x3D;&gt; {
        // For server configuration we need relative paths that&#x27;s why we append &#x60;../..&#x60;
        acc[entryPoint.entryPoint] &#x3D; [
          joinPaths(
            &#x27;../..&#x27;,
            curr.directory,
            entryPoint.directory,
            entryPoint.entryFile
          ),
        ];
      });
      return acc;
    }, {});
  const hadErrorsServer &#x3D; handleConfigUpdate(
    serverEntryPoints,
    &#x27;projects/storefrontapp/tsconfig.server.json&#x27;,
    options
  );

  // Add paths to &#x60;projects/storefrontapp/tsconfig.server.prod.json&#x60; config.
  const serverProdEntryPoints &#x3D; Object.values(libraries)
    .filter((lib) &#x3D;&gt; lib.name !&#x3D;&#x3D; SPARTACUS_SCHEMATICS)
    .reduce((acc, curr) &#x3D;&gt; {
      curr.entryPoints.forEach((entryPoint) &#x3D;&gt; {
        // For server configuration we need relative paths that&#x27;s why we append &#x60;../..&#x60;
        acc[entryPoint.entryPoint] &#x3D; [
          joinPaths(&#x27;../..&#x27;, &#x27;dist&#x27;, curr.distDir, entryPoint.directory),
        ];
      });
      return acc;
    }, {});

  const hadErrorsServerProd &#x3D; handleConfigUpdate(
    serverProdEntryPoints,
    &#x27;projects/storefrontapp/tsconfig.server.prod.json&#x27;,
    options
  );

  if (hadErrorsApp || hadErrorsServer || hadErrorsServerProd) {
    showAllGood &#x3D; false;
  }
  if (showAllGood) {
    success();
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'LibraryWithSpartacusDeps.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
